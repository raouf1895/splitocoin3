(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&i(u)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const Qc="modulepreload",Zc=function(t){return"/"+t},rs={},eu=function(e,r,i){if(!r||r.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(r.map(o=>{if(o=Zc(o),o in rs)return;rs[o]=!0;const u=o.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(!!i)for(let d=n.length-1;d>=0;d--){const I=n[d];if(I.href===o&&(!u||I.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${c}`))return;const y=document.createElement("link");if(y.rel=u?"stylesheet":Qc,u||(y.as="script",y.crossOrigin=""),y.href=o,document.head.appendChild(y),u)return new Promise((d,I)=>{y.addEventListener("load",d),y.addEventListener("error",()=>I(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e())},tu=Symbol(),is=Object.getPrototypeOf,tn=new WeakMap,ru=t=>t&&(tn.has(t)?tn.get(t):is(t)===Object.prototype||is(t)===Array.prototype),iu=t=>ru(t)&&t[tu]||null,ns=(t,e=!0)=>{tn.set(t,e)},Mi=t=>typeof t=="object"&&t!==null,Gt=new WeakMap,ui=new WeakSet,nu=(t=Object.is,e=(d,I)=>new Proxy(d,I),r=d=>Mi(d)&&!ui.has(d)&&(Array.isArray(d)||!(Symbol.iterator in d))&&!(d instanceof WeakMap)&&!(d instanceof WeakSet)&&!(d instanceof Error)&&!(d instanceof Number)&&!(d instanceof Date)&&!(d instanceof String)&&!(d instanceof RegExp)&&!(d instanceof ArrayBuffer),i=d=>d.configurable&&d.enumerable&&d.writable,n=d=>{switch(d.status){case"fulfilled":return d.value;case"rejected":throw d.reason;default:throw d}},o=new WeakMap,u=(d,I,N=n)=>{const O=o.get(d);if((O==null?void 0:O[0])===I)return O[1];const x=Array.isArray(d)?[]:Object.create(Object.getPrototypeOf(d));return ns(x,!0),o.set(d,[I,x]),Reflect.ownKeys(d).forEach(U=>{if(Object.getOwnPropertyDescriptor(x,U))return;const M=Reflect.get(d,U),H={value:M,enumerable:!0,configurable:!0};if(ui.has(M))ns(M,!1);else if(M instanceof Promise)delete H.value,H.get=()=>N(M);else if(Gt.has(M)){const[E,T]=Gt.get(M);H.value=u(E,T(),N)}Object.defineProperty(x,U,H)}),Object.preventExtensions(x)},c=new WeakMap,l=[1,1],y=d=>{if(!Mi(d))throw new Error("object required");const I=c.get(d);if(I)return I;let N=l[0];const O=new Set,x=(D,S=++l[0])=>{N!==S&&(N=S,O.forEach(L=>L(D,S)))};let U=l[1];const M=(D=++l[1])=>(U!==D&&!O.size&&(U=D,E.forEach(([S])=>{const L=S[1](D);L>N&&(N=L)})),N),H=D=>(S,L)=>{const p=[...S];p[1]=[D,...p[1]],x(p,L)},E=new Map,T=(D,S)=>{if(O.size){const L=S[3](H(D));E.set(D,[S,L])}else E.set(D,[S])},b=D=>{var S;const L=E.get(D);L&&(E.delete(D),(S=L[1])==null||S.call(L))},v=D=>(O.add(D),O.size===1&&E.forEach(([L,p],_)=>{const z=L[3](H(_));E.set(_,[L,z])}),()=>{O.delete(D),O.size===0&&E.forEach(([L,p],_)=>{p&&(p(),E.set(_,[L]))})}),f=Array.isArray(d)?[]:Object.create(Object.getPrototypeOf(d)),s=(D,S,L,p,_)=>{if(D&&(t(S,p)||c.has(p)&&t(S,c.get(p))))return;b(L),Mi(p)&&(p=iu(p)||p);let z=p;if(p instanceof Promise)p.then(j=>{p.status="fulfilled",p.value=j,x(["resolve",[L],j])}).catch(j=>{p.status="rejected",p.reason=j,x(["reject",[L],j])});else{!Gt.has(p)&&r(p)&&(z=y(p));const j=!ui.has(z)&&Gt.get(z);j&&T(L,j)}_(z),x(["set",[L],p,S])},$=e(f,{deleteProperty(D,S){const L=Reflect.get(D,S);b(S);const p=Reflect.deleteProperty(D,S);return p&&x(["delete",[S],L]),p},set(D,S,L,p){const _=Reflect.has(D,S),z=Reflect.get(D,S,p);return s(_,z,S,L,j=>{Reflect.set(D,S,j,p)}),!0},defineProperty(D,S,L){if(i(L)){const p=Reflect.getOwnPropertyDescriptor(D,S);if(!p||i(p))return s(!!p&&"value"in p,p==null?void 0:p.value,S,L.value,_=>{Reflect.defineProperty(D,S,{...L,value:_})}),!0}return Reflect.defineProperty(D,S,L)}});c.set(d,$);const w=[f,M,u,v];return Gt.set($,w),Reflect.ownKeys(d).forEach(D=>{const S=Object.getOwnPropertyDescriptor(d,D);"value"in S&&($[D]=d[D],delete S.value,delete S.writable),Object.defineProperty(f,D,S)}),$})=>[y,Gt,ui,t,e,r,i,n,o,u,c,l],[su]=nu();function Qt(t={}){return su(t)}function dr(t,e,r){const i=Gt.get(t);let n;const o=[],u=i[3];let c=!1;const y=u(d=>{if(o.push(d),r){e(o.splice(0));return}n||(n=Promise.resolve().then(()=>{n=void 0,c&&e(o.splice(0))}))});return c=!0,()=>{c=!1,y()}}function ou(t,e){const r=Gt.get(t),[i,n,o]=r;return o(i,n(),e)}const Qe=Qt({history:["ConnectWallet"],view:"ConnectWallet",data:void 0}),Bo={state:Qe,subscribe(t){return dr(Qe,()=>t(Qe))},push(t,e){t!==Qe.view&&(Qe.view=t,e&&(Qe.data=e),Qe.history.push(t))},reset(t){Qe.view=t,Qe.history=[t]},replace(t){Qe.history.length>1&&(Qe.history[Qe.history.length-1]=t,Qe.view=t)},goBack(){if(Qe.history.length>1){Qe.history.pop();const[t]=Qe.history.slice(-1);Qe.view=t}},setData(t){Qe.data=t}},lt={WALLETCONNECT_DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",WCM_VERSION:"WCM_VERSION",RECOMMENDED_WALLET_AMOUNT:9,isMobile(){return typeof window<"u"?!!(window.matchMedia("(pointer:coarse)").matches||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},isAndroid(){return lt.isMobile()&&navigator.userAgent.toLowerCase().includes("android")},isIos(){const t=navigator.userAgent.toLowerCase();return lt.isMobile()&&(t.includes("iphone")||t.includes("ipad"))},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},isArray(t){return Array.isArray(t)&&t.length>0},formatNativeUrl(t,e,r){if(lt.isHttpUrl(t))return this.formatUniversalUrl(t,e,r);let i=t;i.includes("://")||(i=t.replaceAll("/","").replaceAll(":",""),i=`${i}://`),i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const n=encodeURIComponent(e);return`${i}wc?uri=${n}`},formatUniversalUrl(t,e,r){if(!lt.isHttpUrl(t))return this.formatNativeUrl(t,e,r);let i=t;i.endsWith("/")||(i=`${i}/`),this.setWalletConnectDeepLink(i,r);const n=encodeURIComponent(e);return`${i}wc?uri=${n}`},async wait(t){return new Promise(e=>{setTimeout(e,t)})},openHref(t,e){window.open(t,e,"noreferrer noopener")},setWalletConnectDeepLink(t,e){try{localStorage.setItem(lt.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:t,name:e}))}catch{console.info("Unable to set WalletConnect deep link")}},setWalletConnectAndroidDeepLink(t){try{const[e]=t.split("?");localStorage.setItem(lt.WALLETCONNECT_DEEPLINK_CHOICE,JSON.stringify({href:e,name:"Android"}))}catch{console.info("Unable to set WalletConnect android deep link")}},removeWalletConnectDeepLink(){try{localStorage.removeItem(lt.WALLETCONNECT_DEEPLINK_CHOICE)}catch{console.info("Unable to remove WalletConnect deep link")}},setModalVersionInStorage(){try{typeof localStorage<"u"&&localStorage.setItem(lt.WCM_VERSION,"2.6.1")}catch{console.info("Unable to set Web3Modal version in storage")}},getWalletRouterData(){var t;const e=(t=Bo.state.data)==null?void 0:t.Wallet;if(!e)throw new Error('Missing "Wallet" view data');return e}},au=typeof location<"u"&&(location.hostname.includes("localhost")||location.protocol.includes("https")),ot=Qt({enabled:au,userSessionId:"",events:[],connectedWalletId:void 0}),cu={state:ot,subscribe(t){return dr(ot.events,()=>t(ou(ot.events[ot.events.length-1])))},initialize(){ot.enabled&&typeof(crypto==null?void 0:crypto.randomUUID)<"u"&&(ot.userSessionId=crypto.randomUUID())},setConnectedWalletId(t){ot.connectedWalletId=t},click(t){if(ot.enabled){const e={type:"CLICK",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}},track(t){if(ot.enabled){const e={type:"TRACK",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}},view(t){if(ot.enabled){const e={type:"VIEW",name:t.name,userSessionId:ot.userSessionId,timestamp:Date.now(),data:t};ot.events.push(e)}}},Lt=Qt({chains:void 0,walletConnectUri:void 0,isAuth:!1,isCustomDesktop:!1,isCustomMobile:!1,isDataLoaded:!1,isUiLoaded:!1}),Nt={state:Lt,subscribe(t){return dr(Lt,()=>t(Lt))},setChains(t){Lt.chains=t},setWalletConnectUri(t){Lt.walletConnectUri=t},setIsCustomDesktop(t){Lt.isCustomDesktop=t},setIsCustomMobile(t){Lt.isCustomMobile=t},setIsDataLoaded(t){Lt.isDataLoaded=t},setIsUiLoaded(t){Lt.isUiLoaded=t},setIsAuth(t){Lt.isAuth=t}},li=Qt({projectId:"",mobileWallets:void 0,desktopWallets:void 0,walletImages:void 0,chains:void 0,enableAuthMode:!1,enableExplorer:!0,explorerExcludedWalletIds:void 0,explorerRecommendedWalletIds:void 0,termsOfServiceUrl:void 0,privacyPolicyUrl:void 0}),Ir={state:li,subscribe(t){return dr(li,()=>t(li))},setConfig(t){var e,r;cu.initialize(),Nt.setChains(t.chains),Nt.setIsAuth(!!t.enableAuthMode),Nt.setIsCustomMobile(!!((e=t.mobileWallets)!=null&&e.length)),Nt.setIsCustomDesktop(!!((r=t.desktopWallets)!=null&&r.length)),lt.setModalVersionInStorage(),Object.assign(li,t)}};var uu=Object.defineProperty,ss=Object.getOwnPropertySymbols,lu=Object.prototype.hasOwnProperty,hu=Object.prototype.propertyIsEnumerable,os=(t,e,r)=>e in t?uu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,fu=(t,e)=>{for(var r in e||(e={}))lu.call(e,r)&&os(t,r,e[r]);if(ss)for(var r of ss(e))hu.call(e,r)&&os(t,r,e[r]);return t};const rn="https://explorer-api.walletconnect.com",nn="wcm",sn="js-2.6.1";async function hi(t,e){const r=fu({sdkType:nn,sdkVersion:sn},e),i=new URL(t,rn);return i.searchParams.append("projectId",Ir.state.projectId),Object.entries(r).forEach(([n,o])=>{o&&i.searchParams.append(n,String(o))}),(await fetch(i)).json()}const nr={async getDesktopListings(t){return hi("/w3m/v1/getDesktopListings",t)},async getMobileListings(t){return hi("/w3m/v1/getMobileListings",t)},async getInjectedListings(t){return hi("/w3m/v1/getInjectedListings",t)},async getAllListings(t){return hi("/w3m/v1/getAllListings",t)},getWalletImageUrl(t){return`${rn}/w3m/v1/getWalletImage/${t}?projectId=${Ir.state.projectId}&sdkType=${nn}&sdkVersion=${sn}`},getAssetImageUrl(t){return`${rn}/w3m/v1/getAssetImage/${t}?projectId=${Ir.state.projectId}&sdkType=${nn}&sdkVersion=${sn}`}};var du=Object.defineProperty,as=Object.getOwnPropertySymbols,pu=Object.prototype.hasOwnProperty,gu=Object.prototype.propertyIsEnumerable,cs=(t,e,r)=>e in t?du(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,yu=(t,e)=>{for(var r in e||(e={}))pu.call(e,r)&&cs(t,r,e[r]);if(as)for(var r of as(e))gu.call(e,r)&&cs(t,r,e[r]);return t};const us=lt.isMobile(),Ut=Qt({wallets:{listings:[],total:0,page:1},search:{listings:[],total:0,page:1},recomendedWallets:[]}),Ey={state:Ut,async getRecomendedWallets(){const{explorerRecommendedWalletIds:t,explorerExcludedWalletIds:e}=Ir.state;if(t==="NONE"||e==="ALL"&&!t)return Ut.recomendedWallets;if(lt.isArray(t)){const r={recommendedIds:t.join(",")},{listings:i}=await nr.getAllListings(r),n=Object.values(i);n.sort((o,u)=>{const c=t.indexOf(o.id),l=t.indexOf(u.id);return c-l}),Ut.recomendedWallets=n}else{const{chains:r,isAuth:i}=Nt.state,n=r==null?void 0:r.join(","),o=lt.isArray(e),u={page:1,sdks:i?"auth_v1":void 0,entries:lt.RECOMMENDED_WALLET_AMOUNT,chains:n,version:2,excludedIds:o?e.join(","):void 0},{listings:c}=us?await nr.getMobileListings(u):await nr.getDesktopListings(u);Ut.recomendedWallets=Object.values(c)}return Ut.recomendedWallets},async getWallets(t){const e=yu({},t),{explorerRecommendedWalletIds:r,explorerExcludedWalletIds:i}=Ir.state,{recomendedWallets:n}=Ut;if(i==="ALL")return Ut.wallets;n.length?e.excludedIds=n.map(I=>I.id).join(","):lt.isArray(r)&&(e.excludedIds=r.join(",")),lt.isArray(i)&&(e.excludedIds=[e.excludedIds,i].filter(Boolean).join(",")),Nt.state.isAuth&&(e.sdks="auth_v1");const{page:o,search:u}=t,{listings:c,total:l}=us?await nr.getMobileListings(e):await nr.getDesktopListings(e),y=Object.values(c),d=u?"search":"wallets";return Ut[d]={listings:[...Ut[d].listings,...y],total:l,page:o??1},{listings:y,total:l}},getWalletImageUrl(t){return nr.getWalletImageUrl(t)},getAssetImageUrl(t){return nr.getAssetImageUrl(t)},resetSearch(){Ut.search={listings:[],total:0,page:1}}},_r=Qt({open:!1}),$i={state:_r,subscribe(t){return dr(_r,()=>t(_r))},async open(t){return new Promise(e=>{const{isUiLoaded:r,isDataLoaded:i}=Nt.state;if(lt.removeWalletConnectDeepLink(),Nt.setWalletConnectUri(t==null?void 0:t.uri),Nt.setChains(t==null?void 0:t.chains),Bo.reset("ConnectWallet"),r&&i)_r.open=!0,e();else{const n=setInterval(()=>{const o=Nt.state;o.isUiLoaded&&o.isDataLoaded&&(clearInterval(n),_r.open=!0,e())},200)}})},close(){_r.open=!1}};var bu=Object.defineProperty,ls=Object.getOwnPropertySymbols,_u=Object.prototype.hasOwnProperty,wu=Object.prototype.propertyIsEnumerable,hs=(t,e,r)=>e in t?bu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,mu=(t,e)=>{for(var r in e||(e={}))_u.call(e,r)&&hs(t,r,e[r]);if(ls)for(var r of ls(e))wu.call(e,r)&&hs(t,r,e[r]);return t};function vu(){return typeof matchMedia<"u"&&matchMedia("(prefers-color-scheme: dark)").matches}const Rr=Qt({themeMode:vu()?"dark":"light"}),fs={state:Rr,subscribe(t){return dr(Rr,()=>t(Rr))},setThemeConfig(t){const{themeMode:e,themeVariables:r}=t;e&&(Rr.themeMode=e),r&&(Rr.themeVariables=mu({},r))}},sr=Qt({open:!1,message:"",variant:"success"}),Dy={state:sr,subscribe(t){return dr(sr,()=>t(sr))},openToast(t,e){sr.open=!0,sr.message=t,sr.variant=e},closeToast(){sr.open=!1}};let Eu=class{constructor(e){this.openModal=$i.open,this.closeModal=$i.close,this.subscribeModal=$i.subscribe,this.setTheme=fs.setThemeConfig,fs.setThemeConfig(e),Ir.setConfig(e),this.initUi()}async initUi(){if(typeof window<"u"){await eu(()=>import("./index-fc3da199.js"),[]);const e=document.createElement("wcm-modal");document.body.insertAdjacentElement("beforeend",e),Nt.setIsUiLoaded(!0)}}};var dt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function zo(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){if(this instanceof i){var n=[null];n.push.apply(n,arguments);var o=Function.bind.apply(e,n);return new o}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var En={exports:{}},Dr=typeof Reflect=="object"?Reflect:null,ds=Dr&&typeof Dr.apply=="function"?Dr.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},di;Dr&&typeof Dr.ownKeys=="function"?di=Dr.ownKeys:Object.getOwnPropertySymbols?di=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:di=function(e){return Object.getOwnPropertyNames(e)};function Du(t){console&&console.warn&&console.warn(t)}var Ko=Number.isNaN||function(e){return e!==e};function Ie(){Ie.init.call(this)}En.exports=Ie;En.exports.once=xu;Ie.EventEmitter=Ie;Ie.prototype._events=void 0;Ie.prototype._eventsCount=0;Ie.prototype._maxListeners=void 0;var ps=10;function Si(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return ps},set:function(t){if(typeof t!="number"||t<0||Ko(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");ps=t}});Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ie.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ko(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Vo(t){return t._maxListeners===void 0?Ie.defaultMaxListeners:t._maxListeners}Ie.prototype.getMaxListeners=function(){return Vo(this)};Ie.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",o=this._events;if(o!==void 0)n=n&&o.error===void 0;else if(!n)return!1;if(n){var u;if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var c=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw c.context=u,c}var l=o[e];if(l===void 0)return!1;if(typeof l=="function")ds(l,this,r);else for(var y=l.length,d=Yo(l,y),i=0;i<y;++i)ds(d[i],this,r);return!0};function Ho(t,e,r,i){var n,o,u;if(Si(r),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),u=o[e]),u===void 0)u=o[e]=r,++t._eventsCount;else if(typeof u=="function"?u=o[e]=i?[r,u]:[u,r]:i?u.unshift(r):u.push(r),n=Vo(t),n>0&&u.length>n&&!u.warned){u.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+u.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=u.length,Du(c)}return t}Ie.prototype.addListener=function(e,r){return Ho(this,e,r,!1)};Ie.prototype.on=Ie.prototype.addListener;Ie.prototype.prependListener=function(e,r){return Ho(this,e,r,!0)};function Su(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Wo(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Su.bind(i);return n.listener=r,i.wrapFn=n,n}Ie.prototype.once=function(e,r){return Si(r),this.on(e,Wo(this,e,r)),this};Ie.prototype.prependOnceListener=function(e,r){return Si(r),this.prependListener(e,Wo(this,e,r)),this};Ie.prototype.removeListener=function(e,r){var i,n,o,u,c;if(Si(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(o=-1,u=i.length-1;u>=0;u--)if(i[u]===r||i[u].listener===r){c=i[u].listener,o=u;break}if(o<0)return this;o===0?i.shift():Iu(i,o),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var o=Object.keys(i),u;for(n=0;n<o.length;++n)u=o[n],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function ko(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?Ou(n):Yo(n,n.length)}Ie.prototype.listeners=function(e){return ko(this,e,!0)};Ie.prototype.rawListeners=function(e){return ko(this,e,!1)};Ie.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Go.call(t,e)};Ie.prototype.listenerCount=Go;function Go(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?di(this._events):[]};function Yo(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Iu(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function Ou(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function xu(t,e){return new Promise(function(r,i){function n(u){t.removeListener(e,o),i(u)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}Jo(t,e,o,{once:!0}),e!=="error"&&Au(t,n,{once:!0})})}function Au(t,e,r){typeof t.on=="function"&&Jo(t,"error",e,r)}function Jo(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(o){i.once&&t.removeEventListener(e,n),r(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}var Pt=En.exports;const Xo=qo(Pt);var Ii={},Qo={exports:{}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */(function(t){var e,r,i,n,o,u,c,l,y,d,I,N,O,x,U,M,H,E,T,b,v,f,s;(function(h){var $=typeof dt=="object"?dt:typeof self=="object"?self:typeof this=="object"?this:{};h(w($,w(t.exports)));function w(D,S){return D!==$&&(typeof Object.create=="function"?Object.defineProperty(D,"__esModule",{value:!0}):D.__esModule=!0),function(L,p){return D[L]=S?S(L,p):p}}})(function(h){var $=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(w,D){w.__proto__=D}||function(w,D){for(var S in D)D.hasOwnProperty(S)&&(w[S]=D[S])};e=function(w,D){$(w,D);function S(){this.constructor=w}w.prototype=D===null?Object.create(D):(S.prototype=D.prototype,new S)},r=Object.assign||function(w){for(var D,S=1,L=arguments.length;S<L;S++){D=arguments[S];for(var p in D)Object.prototype.hasOwnProperty.call(D,p)&&(w[p]=D[p])}return w},i=function(w,D){var S={};for(var L in w)Object.prototype.hasOwnProperty.call(w,L)&&D.indexOf(L)<0&&(S[L]=w[L]);if(w!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,L=Object.getOwnPropertySymbols(w);p<L.length;p++)D.indexOf(L[p])<0&&Object.prototype.propertyIsEnumerable.call(w,L[p])&&(S[L[p]]=w[L[p]]);return S},n=function(w,D,S,L){var p=arguments.length,_=p<3?D:L===null?L=Object.getOwnPropertyDescriptor(D,S):L,z;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(w,D,S,L);else for(var j=w.length-1;j>=0;j--)(z=w[j])&&(_=(p<3?z(_):p>3?z(D,S,_):z(D,S))||_);return p>3&&_&&Object.defineProperty(D,S,_),_},o=function(w,D){return function(S,L){D(S,L,w)}},u=function(w,D){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(w,D)},c=function(w,D,S,L){function p(_){return _ instanceof S?_:new S(function(z){z(_)})}return new(S||(S=Promise))(function(_,z){function j(B){try{F(L.next(B))}catch(V){z(V)}}function q(B){try{F(L.throw(B))}catch(V){z(V)}}function F(B){B.done?_(B.value):p(B.value).then(j,q)}F((L=L.apply(w,D||[])).next())})},l=function(w,D){var S={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},L,p,_,z;return z={next:j(0),throw:j(1),return:j(2)},typeof Symbol=="function"&&(z[Symbol.iterator]=function(){return this}),z;function j(F){return function(B){return q([F,B])}}function q(F){if(L)throw new TypeError("Generator is already executing.");for(;S;)try{if(L=1,p&&(_=F[0]&2?p.return:F[0]?p.throw||((_=p.return)&&_.call(p),0):p.next)&&!(_=_.call(p,F[1])).done)return _;switch(p=0,_&&(F=[F[0]&2,_.value]),F[0]){case 0:case 1:_=F;break;case 4:return S.label++,{value:F[1],done:!1};case 5:S.label++,p=F[1],F=[0];continue;case 7:F=S.ops.pop(),S.trys.pop();continue;default:if(_=S.trys,!(_=_.length>0&&_[_.length-1])&&(F[0]===6||F[0]===2)){S=0;continue}if(F[0]===3&&(!_||F[1]>_[0]&&F[1]<_[3])){S.label=F[1];break}if(F[0]===6&&S.label<_[1]){S.label=_[1],_=F;break}if(_&&S.label<_[2]){S.label=_[2],S.ops.push(F);break}_[2]&&S.ops.pop(),S.trys.pop();continue}F=D.call(w,S)}catch(B){F=[6,B],p=0}finally{L=_=0}if(F[0]&5)throw F[1];return{value:F[0]?F[1]:void 0,done:!0}}},s=function(w,D,S,L){L===void 0&&(L=S),w[L]=D[S]},y=function(w,D){for(var S in w)S!=="default"&&!D.hasOwnProperty(S)&&(D[S]=w[S])},d=function(w){var D=typeof Symbol=="function"&&Symbol.iterator,S=D&&w[D],L=0;if(S)return S.call(w);if(w&&typeof w.length=="number")return{next:function(){return w&&L>=w.length&&(w=void 0),{value:w&&w[L++],done:!w}}};throw new TypeError(D?"Object is not iterable.":"Symbol.iterator is not defined.")},I=function(w,D){var S=typeof Symbol=="function"&&w[Symbol.iterator];if(!S)return w;var L=S.call(w),p,_=[],z;try{for(;(D===void 0||D-- >0)&&!(p=L.next()).done;)_.push(p.value)}catch(j){z={error:j}}finally{try{p&&!p.done&&(S=L.return)&&S.call(L)}finally{if(z)throw z.error}}return _},N=function(){for(var w=[],D=0;D<arguments.length;D++)w=w.concat(I(arguments[D]));return w},O=function(){for(var w=0,D=0,S=arguments.length;D<S;D++)w+=arguments[D].length;for(var L=Array(w),p=0,D=0;D<S;D++)for(var _=arguments[D],z=0,j=_.length;z<j;z++,p++)L[p]=_[z];return L},x=function(w){return this instanceof x?(this.v=w,this):new x(w)},U=function(w,D,S){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L=S.apply(w,D||[]),p,_=[];return p={},z("next"),z("throw"),z("return"),p[Symbol.asyncIterator]=function(){return this},p;function z(Q){L[Q]&&(p[Q]=function(W){return new Promise(function(ee,Y){_.push([Q,W,ee,Y])>1||j(Q,W)})})}function j(Q,W){try{q(L[Q](W))}catch(ee){V(_[0][3],ee)}}function q(Q){Q.value instanceof x?Promise.resolve(Q.value.v).then(F,B):V(_[0][2],Q)}function F(Q){j("next",Q)}function B(Q){j("throw",Q)}function V(Q,W){Q(W),_.shift(),_.length&&j(_[0][0],_[0][1])}},M=function(w){var D,S;return D={},L("next"),L("throw",function(p){throw p}),L("return"),D[Symbol.iterator]=function(){return this},D;function L(p,_){D[p]=w[p]?function(z){return(S=!S)?{value:x(w[p](z)),done:p==="return"}:_?_(z):z}:_}},H=function(w){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var D=w[Symbol.asyncIterator],S;return D?D.call(w):(w=typeof d=="function"?d(w):w[Symbol.iterator](),S={},L("next"),L("throw"),L("return"),S[Symbol.asyncIterator]=function(){return this},S);function L(_){S[_]=w[_]&&function(z){return new Promise(function(j,q){z=w[_](z),p(j,q,z.done,z.value)})}}function p(_,z,j,q){Promise.resolve(q).then(function(F){_({value:F,done:j})},z)}},E=function(w,D){return Object.defineProperty?Object.defineProperty(w,"raw",{value:D}):w.raw=D,w},T=function(w){if(w&&w.__esModule)return w;var D={};if(w!=null)for(var S in w)Object.hasOwnProperty.call(w,S)&&(D[S]=w[S]);return D.default=w,D},b=function(w){return w&&w.__esModule?w:{default:w}},v=function(w,D){if(!D.has(w))throw new TypeError("attempted to get private field on non-instance");return D.get(w)},f=function(w,D,S){if(!D.has(w))throw new TypeError("attempted to set private field on non-instance");return D.set(w,S),S},h("__extends",e),h("__assign",r),h("__rest",i),h("__decorate",n),h("__param",o),h("__metadata",u),h("__awaiter",c),h("__generator",l),h("__exportStar",y),h("__createBinding",s),h("__values",d),h("__read",I),h("__spread",N),h("__spreadArrays",O),h("__await",x),h("__asyncGenerator",U),h("__asyncDelegator",M),h("__asyncValues",H),h("__makeTemplateObject",E),h("__importStar",T),h("__importDefault",b),h("__classPrivateFieldGet",v),h("__classPrivateFieldSet",f)})})(Qo);var Ot=Qo.exports,Jr={};Object.defineProperty(Jr,"__esModule",{value:!0});function Cu(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return JSON.parse(t)}catch{return t}}Jr.safeJsonParse=Cu;function Tu(t){return typeof t=="string"?t:JSON.stringify(t,(e,r)=>typeof r>"u"?null:r)}Jr.safeJsonStringify=Tu;var Lr={exports:{}},gs;function Nu(){return gs||(gs=1,function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof dt<"u"&&dt.localStorage?Lr.exports=dt.localStorage:typeof window<"u"&&window.localStorage?Lr.exports=window.localStorage:Lr.exports=new e}()),Lr.exports}var ji={},Ur={},ys;function Pu(){if(ys)return Ur;ys=1,Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.IKeyValueStorage=void 0;class t{}return Ur.IKeyValueStorage=t,Ur}var Fr={},bs;function Ru(){if(bs)return Fr;bs=1,Object.defineProperty(Fr,"__esModule",{value:!0}),Fr.parseEntry=void 0;const t=Jr;function e(r){var i;return[r[0],t.safeJsonParse((i=r[1])!==null&&i!==void 0?i:"")]}return Fr.parseEntry=e,Fr}var _s;function Lu(){return _s||(_s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(Pu(),t),e.__exportStar(Ru(),t)}(ji)),ji}Object.defineProperty(Ii,"__esModule",{value:!0});Ii.KeyValueStorage=void 0;const mr=Ot,ws=Jr,Uu=mr.__importDefault(Nu()),Fu=Lu();class Zo{constructor(){this.localStorage=Uu.default}getKeys(){return mr.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return mr.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(Fu.parseEntry)})}getItem(e){return mr.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(e);if(r!==null)return ws.safeJsonParse(r)})}setItem(e,r){return mr.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(e,ws.safeJsonStringify(r))})}removeItem(e){return mr.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(e)})}}Ii.KeyValueStorage=Zo;var Mu=Ii.default=Zo,Or={},Mr={},Z={},Bi={},$r={},ms;function $u(){if(ms)return $r;ms=1,Object.defineProperty($r,"__esModule",{value:!0}),$r.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return $r.delay=t,$r}var or={},qi={},ar={},vs;function ju(){return vs||(vs=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.ONE_THOUSAND=ar.ONE_HUNDRED=void 0,ar.ONE_HUNDRED=100,ar.ONE_THOUSAND=1e3),ar}var zi={},Es;function Bu(){return Es||(Es=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(zi)),zi}var Ds;function ea(){return Ds||(Ds=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(ju(),t),e.__exportStar(Bu(),t)}(qi)),qi}var Ss;function qu(){if(Ss)return or;Ss=1,Object.defineProperty(or,"__esModule",{value:!0}),or.fromMiliseconds=or.toMiliseconds=void 0;const t=ea();function e(i){return i*t.ONE_THOUSAND}or.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return or.fromMiliseconds=r,or}var Is;function zu(){return Is||(Is=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar($u(),t),e.__exportStar(qu(),t)}(Bi)),Bi}var wr={},Os;function Ku(){if(Os)return wr;Os=1,Object.defineProperty(wr,"__esModule",{value:!0}),wr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return wr.Watch=t,wr.default=t,wr}var Ki={},jr={},xs;function Vu(){if(xs)return jr;xs=1,Object.defineProperty(jr,"__esModule",{value:!0}),jr.IWatch=void 0;class t{}return jr.IWatch=t,jr}var As;function Hu(){return As||(As=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(Vu(),t)}(Ki)),Ki}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(zu(),t),e.__exportStar(Ku(),t),e.__exportStar(Hu(),t),e.__exportStar(ea(),t)})(Z);var Vi={},Br={};let pr=class{};const Wu=Object.freeze(Object.defineProperty({__proto__:null,IEvents:pr},Symbol.toStringTag,{value:"Module"})),ku=zo(Wu);var Cs;function Gu(){if(Cs)return Br;Cs=1,Object.defineProperty(Br,"__esModule",{value:!0}),Br.IHeartBeat=void 0;const t=ku;class e extends t.IEvents{constructor(i){super()}}return Br.IHeartBeat=e,Br}var Ts;function ta(){return Ts||(Ts=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(Gu(),t)}(Vi)),Vi}var Hi={},cr={},Ns;function Yu(){if(Ns)return cr;Ns=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.HEARTBEAT_EVENTS=cr.HEARTBEAT_INTERVAL=void 0;const t=Z;return cr.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,cr.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},cr}var Ps;function ra(){return Ps||(Ps=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ot.__exportStar(Yu(),t)}(Hi)),Hi}var Rs;function Ju(){if(Rs)return Mr;Rs=1,Object.defineProperty(Mr,"__esModule",{value:!0}),Mr.HeartBeat=void 0;const t=Ot,e=Pt,r=Z,i=ta(),n=ra();class o extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=(c==null?void 0:c.interval)||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const l=new o(c);return yield l.init(),l})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,l){this.events.on(c,l)}once(c,l){this.events.once(c,l)}off(c,l){this.events.off(c,l)}removeListener(c,l){this.events.removeListener(c,l)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return Mr.HeartBeat=o,Mr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(Ju(),t),e.__exportStar(ta(),t),e.__exportStar(ra(),t)})(Or);var we={},Wi,Ls;function Xu(){if(Ls)return Wi;Ls=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Wi=e;function e(r,i,n){var o=n&&n.stringify||t,u=1;if(typeof r=="object"&&r!==null){var c=i.length+u;if(c===1)return r;var l=new Array(c);l[0]=o(r);for(var y=1;y<c;y++)l[y]=o(i[y]);return l.join(" ")}if(typeof r!="string")return r;var d=i.length;if(d===0)return r;for(var I="",N=1-u,O=-1,x=r&&r.length||0,U=0;U<x;){if(r.charCodeAt(U)===37&&U+1<x){switch(O=O>-1?O:0,r.charCodeAt(U+1)){case 100:case 102:if(N>=d||i[N]==null)break;O<U&&(I+=r.slice(O,U)),I+=Number(i[N]),O=U+2,U++;break;case 105:if(N>=d||i[N]==null)break;O<U&&(I+=r.slice(O,U)),I+=Math.floor(Number(i[N])),O=U+2,U++;break;case 79:case 111:case 106:if(N>=d||i[N]===void 0)break;O<U&&(I+=r.slice(O,U));var M=typeof i[N];if(M==="string"){I+="'"+i[N]+"'",O=U+2,U++;break}if(M==="function"){I+=i[N].name||"<anonymous>",O=U+2,U++;break}I+=o(i[N]),O=U+2,U++;break;case 115:if(N>=d)break;O<U&&(I+=r.slice(O,U)),I+=String(i[N]),O=U+2,U++;break;case 37:O<U&&(I+=r.slice(O,U)),I+="%",O=U+2,U++,N--;break}++N}++U}return O===-1?r:(O<x&&(I+=r.slice(O)),I)}return Wi}var ki,Us;function Qu(){if(Us)return ki;Us=1;const t=Xu();ki=n;const e=v().console||{},r={mapHttpRequest:x,mapHttpResponse:x,wrapRequestSerializer:U,wrapResponseSerializer:U,wrapErrorSerializer:U,req:x,res:x,err:N};function i(f,s){return Array.isArray(f)?f.filter(function($){return $!=="!stdSerializers.err"}):f===!0?Object.keys(s):!1}function n(f){f=f||{},f.browser=f.browser||{};const s=f.browser.transmit;if(s&&typeof s.send!="function")throw Error("pino: transmit option must have a send function");const h=f.browser.write||e;f.browser.write&&(f.browser.asObject=!0);const $=f.serializers||{},w=i(f.browser.serialize,$);let D=f.browser.serialize;Array.isArray(f.browser.serialize)&&f.browser.serialize.indexOf("!stdSerializers.err")>-1&&(D=!1);const S=["error","fatal","warn","info","debug","trace"];typeof h=="function"&&(h.error=h.fatal=h.warn=h.info=h.debug=h.trace=h),f.enabled===!1&&(f.level="silent");const L=f.level||"info",p=Object.create(h);p.log||(p.log=M),Object.defineProperty(p,"levelVal",{get:z}),Object.defineProperty(p,"level",{get:j,set:q});const _={transmit:s,serialize:w,asObject:f.browser.asObject,levels:S,timestamp:O(f)};p.levels=n.levels,p.level=L,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=M,p.serializers=$,p._serialize=w,p._stdErrSerialize=D,p.child=F,s&&(p._logEvent=I());function z(){return this.level==="silent"?1/0:this.levels.values[this.level]}function j(){return this._level}function q(B){if(B!=="silent"&&!this.levels.values[B])throw Error("unknown level "+B);this._level=B,o(_,p,"error","log"),o(_,p,"fatal","error"),o(_,p,"warn","error"),o(_,p,"info","log"),o(_,p,"debug","log"),o(_,p,"trace","log")}function F(B,V){if(!B)throw new Error("missing bindings for child Pino");V=V||{},w&&B.serializers&&(V.serializers=B.serializers);const Q=V.serializers;if(w&&Q){var W=Object.assign({},$,Q),ee=f.browser.serialize===!0?Object.keys(W):w;delete B.serializers,l([B],ee,W,this._stdErrSerialize)}function Y(te){this._childLevel=(te._childLevel|0)+1,this.error=y(te,B,"error"),this.fatal=y(te,B,"fatal"),this.warn=y(te,B,"warn"),this.info=y(te,B,"info"),this.debug=y(te,B,"debug"),this.trace=y(te,B,"trace"),W&&(this.serializers=W,this._serialize=ee),s&&(this._logEvent=I([].concat(te._logEvent.bindings,B)))}return Y.prototype=this,new Y(this)}return p}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:H,epochTime:E,unixTime:T,isoTime:b});function o(f,s,h,$){const w=Object.getPrototypeOf(s);s[h]=s.levelVal>s.levels.values[h]?M:w[h]?w[h]:e[h]||e[$]||M,u(f,s,h)}function u(f,s,h){!f.transmit&&s[h]===M||(s[h]=function($){return function(){const D=f.timestamp(),S=new Array(arguments.length),L=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var p=0;p<S.length;p++)S[p]=arguments[p];if(f.serialize&&!f.asObject&&l(S,this._serialize,this.serializers,this._stdErrSerialize),f.asObject?$.call(L,c(this,h,S,D)):$.apply(L,S),f.transmit){const _=f.transmit.level||s.level,z=n.levels.values[_],j=n.levels.values[h];if(j<z)return;d(this,{ts:D,methodLevel:h,methodValue:j,transmitLevel:_,transmitValue:n.levels.values[f.transmit.level||s.level],send:f.transmit.send,val:s.levelVal},S)}}}(s[h]))}function c(f,s,h,$){f._serialize&&l(h,f._serialize,f.serializers,f._stdErrSerialize);const w=h.slice();let D=w[0];const S={};$&&(S.time=$),S.level=n.levels.values[s];let L=(f._childLevel|0)+1;if(L<1&&(L=1),D!==null&&typeof D=="object"){for(;L--&&typeof w[0]=="object";)Object.assign(S,w.shift());D=w.length?t(w.shift(),w):void 0}else typeof D=="string"&&(D=t(w.shift(),w));return D!==void 0&&(S.msg=D),S}function l(f,s,h,$){for(const w in f)if($&&f[w]instanceof Error)f[w]=n.stdSerializers.err(f[w]);else if(typeof f[w]=="object"&&!Array.isArray(f[w]))for(const D in f[w])s&&s.indexOf(D)>-1&&D in h&&(f[w][D]=h[D](f[w][D]))}function y(f,s,h){return function(){const $=new Array(1+arguments.length);$[0]=s;for(var w=1;w<$.length;w++)$[w]=arguments[w-1];return f[h].apply(this,$)}}function d(f,s,h){const $=s.send,w=s.ts,D=s.methodLevel,S=s.methodValue,L=s.val,p=f._logEvent.bindings;l(h,f._serialize||Object.keys(f.serializers),f.serializers,f._stdErrSerialize===void 0?!0:f._stdErrSerialize),f._logEvent.ts=w,f._logEvent.messages=h.filter(function(_){return p.indexOf(_)===-1}),f._logEvent.level.label=D,f._logEvent.level.value=S,$(D,f._logEvent,L),f._logEvent=I(p)}function I(f){return{ts:0,messages:[],bindings:f||[],level:{label:"",value:0}}}function N(f){const s={type:f.constructor.name,msg:f.message,stack:f.stack};for(const h in f)s[h]===void 0&&(s[h]=f[h]);return s}function O(f){return typeof f.timestamp=="function"?f.timestamp:f.timestamp===!1?H:E}function x(){return{}}function U(f){return f}function M(){}function H(){return!1}function E(){return Date.now()}function T(){return Math.round(Date.now()/1e3)}function b(){return new Date(Date.now()).toISOString()}function v(){function f(s){return typeof s<"u"&&s}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return f(self)||f(window)||f(this)||{}}}return ki}var ur={},Fs;function ia(){return Fs||(Fs=1,Object.defineProperty(ur,"__esModule",{value:!0}),ur.PINO_CUSTOM_CONTEXT_KEY=ur.PINO_LOGGER_DEFAULTS=void 0,ur.PINO_LOGGER_DEFAULTS={level:"info"},ur.PINO_CUSTOM_CONTEXT_KEY="custom_context"),ur}var ht={},Ms;function Zu(){if(Ms)return ht;Ms=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.generateChildLogger=ht.formatChildLoggerContext=ht.getLoggerContext=ht.setBrowserLoggerContext=ht.getBrowserLoggerContext=ht.getDefaultLoggerOptions=void 0;const t=ia();function e(c){return Object.assign(Object.assign({},c),{level:(c==null?void 0:c.level)||t.PINO_LOGGER_DEFAULTS.level})}ht.getDefaultLoggerOptions=e;function r(c,l=t.PINO_CUSTOM_CONTEXT_KEY){return c[l]||""}ht.getBrowserLoggerContext=r;function i(c,l,y=t.PINO_CUSTOM_CONTEXT_KEY){return c[y]=l,c}ht.setBrowserLoggerContext=i;function n(c,l=t.PINO_CUSTOM_CONTEXT_KEY){let y="";return typeof c.bindings>"u"?y=r(c,l):y=c.bindings().context||"",y}ht.getLoggerContext=n;function o(c,l,y=t.PINO_CUSTOM_CONTEXT_KEY){const d=n(c,y);return d.trim()?`${d}/${l}`:l}ht.formatChildLoggerContext=o;function u(c,l,y=t.PINO_CUSTOM_CONTEXT_KEY){const d=o(c,l,y),I=c.child({context:d});return i(I,d,y)}return ht.generateChildLogger=u,ht}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=Ot,r=e.__importDefault(Qu());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(ia(),t),e.__exportStar(Zu(),t)})(we);let el=class extends pr{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}},tl=class extends pr{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}},rl=class{constructor(e,r){this.logger=e,this.core=r}},il=class extends pr{constructor(e,r){super(),this.relayer=e,this.logger=r}},nl=class extends pr{constructor(e){super()}},sl=class{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}};class ol extends pr{constructor(e,r){super(),this.relayer=e,this.logger=r}}class al extends pr{constructor(e,r){super(),this.core=e,this.logger=r}}let cl=class{constructor(e,r){this.projectId=e,this.logger=r}},ul=class{constructor(e){this.opts=e,this.protocol="wc",this.version=2}},ll=class{constructor(e){this.client=e}};const hl=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),fl=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function na(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return fl(t)}catch{return t}}function Dn(t){return typeof t=="string"?t:hl(t)||""}var Sn={},xr={},Oi={},xi={};Object.defineProperty(xi,"__esModule",{value:!0});xi.BrowserRandomSource=void 0;const $s=65536;class dl{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=$s)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,$s)));return r}}xi.BrowserRandomSource=dl;function pl(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ai={},vt={};Object.defineProperty(vt,"__esModule",{value:!0});function gl(t){for(var e=0;e<t.length;e++)t[e]=0;return t}vt.wipe=gl;const yl={},bl=Object.freeze(Object.defineProperty({__proto__:null,default:yl},Symbol.toStringTag,{value:"Module"})),_l=zo(bl);Object.defineProperty(Ai,"__esModule",{value:!0});Ai.NodeRandomSource=void 0;const wl=vt;class ml{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof pl<"u"){const e=_l;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,wl.wipe)(r),i}}Ai.NodeRandomSource=ml;Object.defineProperty(Oi,"__esModule",{value:!0});Oi.SystemRandomSource=void 0;const vl=xi,El=Ai;class Dl{constructor(){if(this.isAvailable=!1,this.name="",this._source=new vl.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new El.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Oi.SystemRandomSource=Dl;var ne={},sa={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,l){var y=c>>>16&65535,d=c&65535,I=l>>>16&65535,N=l&65535;return d*N+(y*N+d*I<<16>>>0)|0}t.mul=Math.imul||e;function r(c,l){return c+l|0}t.add=r;function i(c,l){return c-l|0}t.sub=i;function n(c,l){return c<<l|c>>>32-l}t.rotl=n;function o(c,l){return c<<32-l|c>>>l}t.rotr=o;function u(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||u,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})(sa);Object.defineProperty(ne,"__esModule",{value:!0});var oa=sa;function Sl(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ne.readInt16BE=Sl;function Il(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ne.readUint16BE=Il;function Ol(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ne.readInt16LE=Ol;function xl(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ne.readUint16LE=xl;function aa(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ne.writeUint16BE=aa;ne.writeInt16BE=aa;function ca(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ne.writeUint16LE=ca;ne.writeInt16LE=ca;function on(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ne.readInt32BE=on;function an(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ne.readUint32BE=an;function cn(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ne.readInt32LE=cn;function un(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ne.readUint32LE=un;function yi(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ne.writeUint32BE=yi;ne.writeInt32BE=yi;function bi(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ne.writeUint32LE=bi;ne.writeInt32LE=bi;function Al(t,e){e===void 0&&(e=0);var r=on(t,e),i=on(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ne.readInt64BE=Al;function Cl(t,e){e===void 0&&(e=0);var r=an(t,e),i=an(t,e+4);return r*4294967296+i}ne.readUint64BE=Cl;function Tl(t,e){e===void 0&&(e=0);var r=cn(t,e),i=cn(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ne.readInt64LE=Tl;function Nl(t,e){e===void 0&&(e=0);var r=un(t,e),i=un(t,e+4);return i*4294967296+r}ne.readUint64LE=Nl;function ua(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),yi(t/4294967296>>>0,e,r),yi(t>>>0,e,r+4),e}ne.writeUint64BE=ua;ne.writeInt64BE=ua;function la(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),bi(t>>>0,e,r),bi(t/4294967296>>>0,e,r+4),e}ne.writeUint64LE=la;ne.writeInt64LE=la;function Pl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,o=t/8+r-1;o>=r;o--)i+=e[o]*n,n*=256;return i}ne.readUintBE=Pl;function Rl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,o=r;o<r+t/8;o++)i+=e[o]*n,n*=256;return i}ne.readUintLE=Rl;function Ll(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!oa.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,o=t/8+i-1;o>=i;o--)r[o]=e/n&255,n*=256;return r}ne.writeUintBE=Ll;function Ul(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!oa.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,o=i;o<i+t/8;o++)r[o]=e/n&255,n*=256;return r}ne.writeUintLE=Ul;function Fl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ne.readFloat32BE=Fl;function Ml(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ne.readFloat32LE=Ml;function $l(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ne.readFloat64BE=$l;function jl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ne.readFloat64LE=jl;function Bl(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ne.writeFloat32BE=Bl;function ql(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ne.writeFloat32LE=ql;function zl(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ne.writeFloat64BE=zl;function Kl(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ne.writeFloat64LE=Kl;(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Oi,r=ne,i=vt;t.defaultRandomSource=new e.SystemRandomSource;function n(y,d=t.defaultRandomSource){return d.randomBytes(y)}t.randomBytes=n;function o(y=t.defaultRandomSource){const d=n(4,y),I=(0,r.readUint32LE)(d);return(0,i.wipe)(d),I}t.randomUint32=o;const u="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(y,d=u,I=t.defaultRandomSource){if(d.length<2)throw new Error("randomString charset is too short");if(d.length>256)throw new Error("randomString charset is too long");let N="";const O=d.length,x=256-256%O;for(;y>0;){const U=n(Math.ceil(y*256/x),I);for(let M=0;M<U.length&&y>0;M++){const H=U[M];H<x&&(N+=d.charAt(H%O),y--)}(0,i.wipe)(U)}return N}t.randomString=c;function l(y,d=u,I=t.defaultRandomSource){const N=Math.ceil(y/(Math.log(d.length)/Math.LN2));return c(N,d,I)}t.randomStringForEntropy=l})(xr);var ha={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ne,r=vt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(l,y){if(y===void 0&&(y=l.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var d=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&y>0;)this._buffer[this._bufferLength++]=l[d++],y--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(d=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,l,d,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=l[d++],y--;return this},c.prototype.finish=function(l){if(!this._finished){var y=this._bytesHashed,d=this._bufferLength,I=y/536870912|0,N=y<<3,O=y%128<112?128:256;this._buffer[d]=128;for(var x=d+1;x<O-8;x++)this._buffer[x]=0;e.writeUint32BE(I,this._buffer,O-8),e.writeUint32BE(N,this._buffer,O-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,O),this._finished=!0}for(var x=0;x<this.digestLength/8;x++)e.writeUint32BE(this._stateHi[x],l,x*8),e.writeUint32BE(this._stateLo[x],l,x*8+4);return this},c.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(l){return this._stateHi.set(l.stateHi),this._stateLo.set(l.stateLo),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(l){r.wipe(l.stateHi),r.wipe(l.stateLo),l.buffer&&r.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},c}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(c,l,y,d,I,N,O){for(var x=y[0],U=y[1],M=y[2],H=y[3],E=y[4],T=y[5],b=y[6],v=y[7],f=d[0],s=d[1],h=d[2],$=d[3],w=d[4],D=d[5],S=d[6],L=d[7],p,_,z,j,q,F,B,V;O>=128;){for(var Q=0;Q<16;Q++){var W=8*Q+N;c[Q]=e.readUint32BE(I,W),l[Q]=e.readUint32BE(I,W+4)}for(var Q=0;Q<80;Q++){var ee=x,Y=U,te=M,R=H,P=E,A=T,a=b,m=v,k=f,J=s,he=h,be=$,de=w,ve=D,Fe=S,Ne=L;if(p=v,_=L,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=(E>>>14|w<<32-14)^(E>>>18|w<<32-18)^(w>>>41-32|E<<32-(41-32)),_=(w>>>14|E<<32-14)^(w>>>18|E<<32-18)^(E>>>41-32|w<<32-(41-32)),q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,p=E&T^~E&b,_=w&D^~w&S,q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,p=n[Q*2],_=n[Q*2+1],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,p=c[Q%16],_=l[Q%16],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,z=B&65535|V<<16,j=q&65535|F<<16,p=z,_=j,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=(x>>>28|f<<32-28)^(f>>>34-32|x<<32-(34-32))^(f>>>39-32|x<<32-(39-32)),_=(f>>>28|x<<32-28)^(x>>>34-32|f<<32-(34-32))^(x>>>39-32|f<<32-(39-32)),q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,p=x&U^x&M^U&M,_=f&s^f&h^s&h,q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,m=B&65535|V<<16,Ne=q&65535|F<<16,p=R,_=be,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=z,_=j,q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,R=B&65535|V<<16,be=q&65535|F<<16,U=ee,M=Y,H=te,E=R,T=P,b=A,v=a,x=m,s=k,h=J,$=he,w=be,D=de,S=ve,L=Fe,f=Ne,Q%16===15)for(var W=0;W<16;W++)p=c[W],_=l[W],q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=c[(W+9)%16],_=l[(W+9)%16],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,z=c[(W+1)%16],j=l[(W+1)%16],p=(z>>>1|j<<32-1)^(z>>>8|j<<32-8)^z>>>7,_=(j>>>1|z<<32-1)^(j>>>8|z<<32-8)^(j>>>7|z<<32-7),q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,z=c[(W+14)%16],j=l[(W+14)%16],p=(z>>>19|j<<32-19)^(j>>>61-32|z<<32-(61-32))^z>>>6,_=(j>>>19|z<<32-19)^(z>>>61-32|j<<32-(61-32))^(j>>>6|z<<32-6),q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,c[W]=B&65535|V<<16,l[W]=q&65535|F<<16}p=x,_=f,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[0],_=d[0],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[0]=x=B&65535|V<<16,d[0]=f=q&65535|F<<16,p=U,_=s,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[1],_=d[1],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[1]=U=B&65535|V<<16,d[1]=s=q&65535|F<<16,p=M,_=h,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[2],_=d[2],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[2]=M=B&65535|V<<16,d[2]=h=q&65535|F<<16,p=H,_=$,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[3],_=d[3],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[3]=H=B&65535|V<<16,d[3]=$=q&65535|F<<16,p=E,_=w,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[4],_=d[4],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[4]=E=B&65535|V<<16,d[4]=w=q&65535|F<<16,p=T,_=D,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[5],_=d[5],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[5]=T=B&65535|V<<16,d[5]=D=q&65535|F<<16,p=b,_=S,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[6],_=d[6],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[6]=b=B&65535|V<<16,d[6]=S=q&65535|F<<16,p=v,_=L,q=_&65535,F=_>>>16,B=p&65535,V=p>>>16,p=y[7],_=d[7],q+=_&65535,F+=_>>>16,B+=p&65535,V+=p>>>16,F+=q>>>16,B+=F>>>16,V+=B>>>16,y[7]=v=B&65535|V<<16,d[7]=L=q&65535|F<<16,N+=128,O-=128}return N}function u(c){var l=new i;l.update(c);var y=l.digest();return l.clean(),y}t.hash=u})(ha);(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=xr,r=ha,i=vt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(R){const P=new Float64Array(16);if(R)for(let A=0;A<R.length;A++)P[A]=R[A];return P}const o=new Uint8Array(32);o[0]=9;const u=n(),c=n([1]),l=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),d=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),I=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),N=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function O(R,P){for(let A=0;A<16;A++)R[A]=P[A]|0}function x(R){let P=1;for(let A=0;A<16;A++){let a=R[A]+P+65535;P=Math.floor(a/65536),R[A]=a-P*65536}R[0]+=P-1+37*(P-1)}function U(R,P,A){const a=~(A-1);for(let m=0;m<16;m++){const k=a&(R[m]^P[m]);R[m]^=k,P[m]^=k}}function M(R,P){const A=n(),a=n();for(let m=0;m<16;m++)a[m]=P[m];x(a),x(a),x(a);for(let m=0;m<2;m++){A[0]=a[0]-65517;for(let J=1;J<15;J++)A[J]=a[J]-65535-(A[J-1]>>16&1),A[J-1]&=65535;A[15]=a[15]-32767-(A[14]>>16&1);const k=A[15]>>16&1;A[14]&=65535,U(a,A,1-k)}for(let m=0;m<16;m++)R[2*m]=a[m]&255,R[2*m+1]=a[m]>>8}function H(R,P){let A=0;for(let a=0;a<32;a++)A|=R[a]^P[a];return(1&A-1>>>8)-1}function E(R,P){const A=new Uint8Array(32),a=new Uint8Array(32);return M(A,R),M(a,P),H(A,a)}function T(R){const P=new Uint8Array(32);return M(P,R),P[0]&1}function b(R,P){for(let A=0;A<16;A++)R[A]=P[2*A]+(P[2*A+1]<<8);R[15]&=32767}function v(R,P,A){for(let a=0;a<16;a++)R[a]=P[a]+A[a]}function f(R,P,A){for(let a=0;a<16;a++)R[a]=P[a]-A[a]}function s(R,P,A){let a,m,k=0,J=0,he=0,be=0,de=0,ve=0,Fe=0,Ne=0,ye=0,pe=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,le=0,ge=0,ie=0,_e=0,me=0,De=0,Se=0,Ee=0,xt=0,Rt=0,Vt=0,wt=0,er=0,Tr=0,ri=0,Me=A[0],Pe=A[1],$e=A[2],je=A[3],Be=A[4],Re=A[5],Ve=A[6],He=A[7],We=A[8],ke=A[9],Ge=A[10],Ke=A[11],qe=A[12],Ae=A[13],Ye=A[14],Je=A[15];a=P[0],k+=a*Me,J+=a*Pe,he+=a*$e,be+=a*je,de+=a*Be,ve+=a*Re,Fe+=a*Ve,Ne+=a*He,ye+=a*We,pe+=a*ke,fe+=a*Ge,ue+=a*Ke,ce+=a*qe,ae+=a*Ae,oe+=a*Ye,re+=a*Je,a=P[1],J+=a*Me,he+=a*Pe,be+=a*$e,de+=a*je,ve+=a*Be,Fe+=a*Re,Ne+=a*Ve,ye+=a*He,pe+=a*We,fe+=a*ke,ue+=a*Ge,ce+=a*Ke,ae+=a*qe,oe+=a*Ae,re+=a*Ye,le+=a*Je,a=P[2],he+=a*Me,be+=a*Pe,de+=a*$e,ve+=a*je,Fe+=a*Be,Ne+=a*Re,ye+=a*Ve,pe+=a*He,fe+=a*We,ue+=a*ke,ce+=a*Ge,ae+=a*Ke,oe+=a*qe,re+=a*Ae,le+=a*Ye,ge+=a*Je,a=P[3],be+=a*Me,de+=a*Pe,ve+=a*$e,Fe+=a*je,Ne+=a*Be,ye+=a*Re,pe+=a*Ve,fe+=a*He,ue+=a*We,ce+=a*ke,ae+=a*Ge,oe+=a*Ke,re+=a*qe,le+=a*Ae,ge+=a*Ye,ie+=a*Je,a=P[4],de+=a*Me,ve+=a*Pe,Fe+=a*$e,Ne+=a*je,ye+=a*Be,pe+=a*Re,fe+=a*Ve,ue+=a*He,ce+=a*We,ae+=a*ke,oe+=a*Ge,re+=a*Ke,le+=a*qe,ge+=a*Ae,ie+=a*Ye,_e+=a*Je,a=P[5],ve+=a*Me,Fe+=a*Pe,Ne+=a*$e,ye+=a*je,pe+=a*Be,fe+=a*Re,ue+=a*Ve,ce+=a*He,ae+=a*We,oe+=a*ke,re+=a*Ge,le+=a*Ke,ge+=a*qe,ie+=a*Ae,_e+=a*Ye,me+=a*Je,a=P[6],Fe+=a*Me,Ne+=a*Pe,ye+=a*$e,pe+=a*je,fe+=a*Be,ue+=a*Re,ce+=a*Ve,ae+=a*He,oe+=a*We,re+=a*ke,le+=a*Ge,ge+=a*Ke,ie+=a*qe,_e+=a*Ae,me+=a*Ye,De+=a*Je,a=P[7],Ne+=a*Me,ye+=a*Pe,pe+=a*$e,fe+=a*je,ue+=a*Be,ce+=a*Re,ae+=a*Ve,oe+=a*He,re+=a*We,le+=a*ke,ge+=a*Ge,ie+=a*Ke,_e+=a*qe,me+=a*Ae,De+=a*Ye,Se+=a*Je,a=P[8],ye+=a*Me,pe+=a*Pe,fe+=a*$e,ue+=a*je,ce+=a*Be,ae+=a*Re,oe+=a*Ve,re+=a*He,le+=a*We,ge+=a*ke,ie+=a*Ge,_e+=a*Ke,me+=a*qe,De+=a*Ae,Se+=a*Ye,Ee+=a*Je,a=P[9],pe+=a*Me,fe+=a*Pe,ue+=a*$e,ce+=a*je,ae+=a*Be,oe+=a*Re,re+=a*Ve,le+=a*He,ge+=a*We,ie+=a*ke,_e+=a*Ge,me+=a*Ke,De+=a*qe,Se+=a*Ae,Ee+=a*Ye,xt+=a*Je,a=P[10],fe+=a*Me,ue+=a*Pe,ce+=a*$e,ae+=a*je,oe+=a*Be,re+=a*Re,le+=a*Ve,ge+=a*He,ie+=a*We,_e+=a*ke,me+=a*Ge,De+=a*Ke,Se+=a*qe,Ee+=a*Ae,xt+=a*Ye,Rt+=a*Je,a=P[11],ue+=a*Me,ce+=a*Pe,ae+=a*$e,oe+=a*je,re+=a*Be,le+=a*Re,ge+=a*Ve,ie+=a*He,_e+=a*We,me+=a*ke,De+=a*Ge,Se+=a*Ke,Ee+=a*qe,xt+=a*Ae,Rt+=a*Ye,Vt+=a*Je,a=P[12],ce+=a*Me,ae+=a*Pe,oe+=a*$e,re+=a*je,le+=a*Be,ge+=a*Re,ie+=a*Ve,_e+=a*He,me+=a*We,De+=a*ke,Se+=a*Ge,Ee+=a*Ke,xt+=a*qe,Rt+=a*Ae,Vt+=a*Ye,wt+=a*Je,a=P[13],ae+=a*Me,oe+=a*Pe,re+=a*$e,le+=a*je,ge+=a*Be,ie+=a*Re,_e+=a*Ve,me+=a*He,De+=a*We,Se+=a*ke,Ee+=a*Ge,xt+=a*Ke,Rt+=a*qe,Vt+=a*Ae,wt+=a*Ye,er+=a*Je,a=P[14],oe+=a*Me,re+=a*Pe,le+=a*$e,ge+=a*je,ie+=a*Be,_e+=a*Re,me+=a*Ve,De+=a*He,Se+=a*We,Ee+=a*ke,xt+=a*Ge,Rt+=a*Ke,Vt+=a*qe,wt+=a*Ae,er+=a*Ye,Tr+=a*Je,a=P[15],re+=a*Me,le+=a*Pe,ge+=a*$e,ie+=a*je,_e+=a*Be,me+=a*Re,De+=a*Ve,Se+=a*He,Ee+=a*We,xt+=a*ke,Rt+=a*Ge,Vt+=a*Ke,wt+=a*qe,er+=a*Ae,Tr+=a*Ye,ri+=a*Je,k+=38*le,J+=38*ge,he+=38*ie,be+=38*_e,de+=38*me,ve+=38*De,Fe+=38*Se,Ne+=38*Ee,ye+=38*xt,pe+=38*Rt,fe+=38*Vt,ue+=38*wt,ce+=38*er,ae+=38*Tr,oe+=38*ri,m=1,a=k+m+65535,m=Math.floor(a/65536),k=a-m*65536,a=J+m+65535,m=Math.floor(a/65536),J=a-m*65536,a=he+m+65535,m=Math.floor(a/65536),he=a-m*65536,a=be+m+65535,m=Math.floor(a/65536),be=a-m*65536,a=de+m+65535,m=Math.floor(a/65536),de=a-m*65536,a=ve+m+65535,m=Math.floor(a/65536),ve=a-m*65536,a=Fe+m+65535,m=Math.floor(a/65536),Fe=a-m*65536,a=Ne+m+65535,m=Math.floor(a/65536),Ne=a-m*65536,a=ye+m+65535,m=Math.floor(a/65536),ye=a-m*65536,a=pe+m+65535,m=Math.floor(a/65536),pe=a-m*65536,a=fe+m+65535,m=Math.floor(a/65536),fe=a-m*65536,a=ue+m+65535,m=Math.floor(a/65536),ue=a-m*65536,a=ce+m+65535,m=Math.floor(a/65536),ce=a-m*65536,a=ae+m+65535,m=Math.floor(a/65536),ae=a-m*65536,a=oe+m+65535,m=Math.floor(a/65536),oe=a-m*65536,a=re+m+65535,m=Math.floor(a/65536),re=a-m*65536,k+=m-1+37*(m-1),m=1,a=k+m+65535,m=Math.floor(a/65536),k=a-m*65536,a=J+m+65535,m=Math.floor(a/65536),J=a-m*65536,a=he+m+65535,m=Math.floor(a/65536),he=a-m*65536,a=be+m+65535,m=Math.floor(a/65536),be=a-m*65536,a=de+m+65535,m=Math.floor(a/65536),de=a-m*65536,a=ve+m+65535,m=Math.floor(a/65536),ve=a-m*65536,a=Fe+m+65535,m=Math.floor(a/65536),Fe=a-m*65536,a=Ne+m+65535,m=Math.floor(a/65536),Ne=a-m*65536,a=ye+m+65535,m=Math.floor(a/65536),ye=a-m*65536,a=pe+m+65535,m=Math.floor(a/65536),pe=a-m*65536,a=fe+m+65535,m=Math.floor(a/65536),fe=a-m*65536,a=ue+m+65535,m=Math.floor(a/65536),ue=a-m*65536,a=ce+m+65535,m=Math.floor(a/65536),ce=a-m*65536,a=ae+m+65535,m=Math.floor(a/65536),ae=a-m*65536,a=oe+m+65535,m=Math.floor(a/65536),oe=a-m*65536,a=re+m+65535,m=Math.floor(a/65536),re=a-m*65536,k+=m-1+37*(m-1),R[0]=k,R[1]=J,R[2]=he,R[3]=be,R[4]=de,R[5]=ve,R[6]=Fe,R[7]=Ne,R[8]=ye,R[9]=pe,R[10]=fe,R[11]=ue,R[12]=ce,R[13]=ae,R[14]=oe,R[15]=re}function h(R,P){s(R,P,P)}function $(R,P){const A=n();let a;for(a=0;a<16;a++)A[a]=P[a];for(a=253;a>=0;a--)h(A,A),a!==2&&a!==4&&s(A,A,P);for(a=0;a<16;a++)R[a]=A[a]}function w(R,P){const A=n();let a;for(a=0;a<16;a++)A[a]=P[a];for(a=250;a>=0;a--)h(A,A),a!==1&&s(A,A,P);for(a=0;a<16;a++)R[a]=A[a]}function D(R,P){const A=n(),a=n(),m=n(),k=n(),J=n(),he=n(),be=n(),de=n(),ve=n();f(A,R[1],R[0]),f(ve,P[1],P[0]),s(A,A,ve),v(a,R[0],R[1]),v(ve,P[0],P[1]),s(a,a,ve),s(m,R[3],P[3]),s(m,m,y),s(k,R[2],P[2]),v(k,k,k),f(J,a,A),f(he,k,m),v(be,k,m),v(de,a,A),s(R[0],J,he),s(R[1],de,be),s(R[2],be,he),s(R[3],J,de)}function S(R,P,A){for(let a=0;a<4;a++)U(R[a],P[a],A)}function L(R,P){const A=n(),a=n(),m=n();$(m,P[2]),s(A,P[0],m),s(a,P[1],m),M(R,a),R[31]^=T(A)<<7}function p(R,P,A){O(R[0],u),O(R[1],c),O(R[2],c),O(R[3],u);for(let a=255;a>=0;--a){const m=A[a/8|0]>>(a&7)&1;S(R,P,m),D(P,R),D(R,R),S(R,P,m)}}function _(R,P){const A=[n(),n(),n(),n()];O(A[0],d),O(A[1],I),O(A[2],c),s(A[3],d,I),p(R,A,P)}function z(R){if(R.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const P=(0,r.hash)(R);P[0]&=248,P[31]&=127,P[31]|=64;const A=new Uint8Array(32),a=[n(),n(),n(),n()];_(a,P),L(A,a);const m=new Uint8Array(64);return m.set(R),m.set(A,32),{publicKey:A,secretKey:m}}t.generateKeyPairFromSeed=z;function j(R){const P=(0,e.randomBytes)(32,R),A=z(P);return(0,i.wipe)(P),A}t.generateKeyPair=j;function q(R){if(R.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(R.subarray(32))}t.extractPublicKeyFromSecretKey=q;const F=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function B(R,P){let A,a,m,k;for(a=63;a>=32;--a){for(A=0,m=a-32,k=a-12;m<k;++m)P[m]+=A-16*P[a]*F[m-(a-32)],A=Math.floor((P[m]+128)/256),P[m]-=A*256;P[m]+=A,P[a]=0}for(A=0,m=0;m<32;m++)P[m]+=A-(P[31]>>4)*F[m],A=P[m]>>8,P[m]&=255;for(m=0;m<32;m++)P[m]-=A*F[m];for(a=0;a<32;a++)P[a+1]+=P[a]>>8,R[a]=P[a]&255}function V(R){const P=new Float64Array(64);for(let A=0;A<64;A++)P[A]=R[A];for(let A=0;A<64;A++)R[A]=0;B(R,P)}function Q(R,P){const A=new Float64Array(64),a=[n(),n(),n(),n()],m=(0,r.hash)(R.subarray(0,32));m[0]&=248,m[31]&=127,m[31]|=64;const k=new Uint8Array(64);k.set(m.subarray(32),32);const J=new r.SHA512;J.update(k.subarray(32)),J.update(P);const he=J.digest();J.clean(),V(he),_(a,he),L(k,a),J.reset(),J.update(k.subarray(0,32)),J.update(R.subarray(32)),J.update(P);const be=J.digest();V(be);for(let de=0;de<32;de++)A[de]=he[de];for(let de=0;de<32;de++)for(let ve=0;ve<32;ve++)A[de+ve]+=be[de]*m[ve];return B(k.subarray(32),A),k}t.sign=Q;function W(R,P){const A=n(),a=n(),m=n(),k=n(),J=n(),he=n(),be=n();return O(R[2],c),b(R[1],P),h(m,R[1]),s(k,m,l),f(m,m,R[2]),v(k,R[2],k),h(J,k),h(he,J),s(be,he,J),s(A,be,m),s(A,A,k),w(A,A),s(A,A,m),s(A,A,k),s(A,A,k),s(R[0],A,k),h(a,R[0]),s(a,a,k),E(a,m)&&s(R[0],R[0],N),h(a,R[0]),s(a,a,k),E(a,m)?-1:(T(R[0])===P[31]>>7&&f(R[0],u,R[0]),s(R[3],R[0],R[1]),0)}function ee(R,P,A){const a=new Uint8Array(32),m=[n(),n(),n(),n()],k=[n(),n(),n(),n()];if(A.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(W(k,R))return!1;const J=new r.SHA512;J.update(A.subarray(0,32)),J.update(R),J.update(P);const he=J.digest();return V(he),p(m,k,he),_(k,A.subarray(32)),D(m,k),L(a,m),!H(A,a)}t.verify=ee;function Y(R){let P=[n(),n(),n(),n()];if(W(P,R))throw new Error("Ed25519: invalid public key");let A=n(),a=n(),m=P[1];v(A,c,m),f(a,c,m),$(a,a),s(A,A,a);let k=new Uint8Array(32);return M(k,A),k}t.convertPublicKeyToX25519=Y;function te(R){const P=(0,r.hash)(R.subarray(0,32));P[0]&=248,P[31]&=127,P[31]|=64;const A=new Uint8Array(P.subarray(0,32));return(0,i.wipe)(P),A}t.convertSecretKeyToX25519=te})(Sn);const Vl="EdDSA",Hl="JWT",fa=".",da="base64url",Wl="utf8",kl="utf8",Gl=":",Yl="did",Jl="key",js="base58btc",Xl="z",Ql="K36",Zl=32;function In(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function pa(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?In(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function ln(t,e){e||(e=t.reduce((n,o)=>n+o.length,0));const r=pa(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return In(r)}function eh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var o=t.charAt(n),u=o.charCodeAt(0);if(r[u]!==255)throw new TypeError(o+" is ambiguous");r[u]=n}var c=t.length,l=t.charAt(0),y=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function I(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var U=0,M=0,H=0,E=x.length;H!==E&&x[H]===0;)H++,U++;for(var T=(E-H)*d+1>>>0,b=new Uint8Array(T);H!==E;){for(var v=x[H],f=0,s=T-1;(v!==0||f<M)&&s!==-1;s--,f++)v+=256*b[s]>>>0,b[s]=v%c>>>0,v=v/c>>>0;if(v!==0)throw new Error("Non-zero carry");M=f,H++}for(var h=T-M;h!==T&&b[h]===0;)h++;for(var $=l.repeat(U);h<T;++h)$+=t.charAt(b[h]);return $}function N(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var U=0;if(x[U]!==" "){for(var M=0,H=0;x[U]===l;)M++,U++;for(var E=(x.length-U)*y+1>>>0,T=new Uint8Array(E);x[U];){var b=r[x.charCodeAt(U)];if(b===255)return;for(var v=0,f=E-1;(b!==0||v<H)&&f!==-1;f--,v++)b+=c*T[f]>>>0,T[f]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");H=v,U++}if(x[U]!==" "){for(var s=E-H;s!==E&&T[s]===0;)s++;for(var h=new Uint8Array(M+(E-s)),$=M;s!==E;)h[$++]=T[s++];return h}}}function O(x){var U=N(x);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:I,decodeUnsafe:N,decode:O}}var th=eh,rh=th;const ih=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},nh=t=>new TextEncoder().encode(t),sh=t=>new TextDecoder().decode(t);class oh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class ah{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return ga(this,e)}}class ch{constructor(e){this.decoders=e}or(e){return ga(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const ga=(t,e)=>new ch({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class uh{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new oh(e,r,i),this.decoder=new ah(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Ci=({name:t,prefix:e,encode:r,decode:i})=>new uh(t,e,r,i),Xr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=rh(r,e);return Ci({prefix:t,name:e,encode:i,decode:o=>ih(n(o))})},lh=(t,e,r,i)=>{const n={};for(let d=0;d<e.length;++d)n[e[d]]=d;let o=t.length;for(;t[o-1]==="=";)--o;const u=new Uint8Array(o*r/8|0);let c=0,l=0,y=0;for(let d=0;d<o;++d){const I=n[t[d]];if(I===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<r|I,c+=r,c>=8&&(c-=8,u[y++]=255&l>>c)}if(c>=r||255&l<<8-c)throw new SyntaxError("Unexpected end of data");return u},hh=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let o="",u=0,c=0;for(let l=0;l<t.length;++l)for(c=c<<8|t[l],u+=8;u>r;)u-=r,o+=e[n&c>>u];if(u&&(o+=e[n&c<<r-u]),i)for(;o.length*r&7;)o+="=";return o},it=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Ci({prefix:e,name:t,encode(n){return hh(n,i,r)},decode(n){return lh(n,i,r,t)}}),fh=Ci({prefix:"\0",name:"identity",encode:t=>sh(t),decode:t=>nh(t)}),dh=Object.freeze(Object.defineProperty({__proto__:null,identity:fh},Symbol.toStringTag,{value:"Module"})),ph=it({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),gh=Object.freeze(Object.defineProperty({__proto__:null,base2:ph},Symbol.toStringTag,{value:"Module"})),yh=it({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),bh=Object.freeze(Object.defineProperty({__proto__:null,base8:yh},Symbol.toStringTag,{value:"Module"})),_h=Xr({prefix:"9",name:"base10",alphabet:"0123456789"}),wh=Object.freeze(Object.defineProperty({__proto__:null,base10:_h},Symbol.toStringTag,{value:"Module"})),mh=it({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vh=it({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),Eh=Object.freeze(Object.defineProperty({__proto__:null,base16:mh,base16upper:vh},Symbol.toStringTag,{value:"Module"})),Dh=it({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Sh=it({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Ih=it({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oh=it({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xh=it({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ah=it({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Ch=it({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Th=it({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Nh=it({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ph=Object.freeze(Object.defineProperty({__proto__:null,base32:Dh,base32hex:xh,base32hexpad:Ch,base32hexpadupper:Th,base32hexupper:Ah,base32pad:Ih,base32padupper:Oh,base32upper:Sh,base32z:Nh},Symbol.toStringTag,{value:"Module"})),Rh=Xr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Lh=Xr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Uh=Object.freeze(Object.defineProperty({__proto__:null,base36:Rh,base36upper:Lh},Symbol.toStringTag,{value:"Module"})),Fh=Xr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Mh=Xr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),$h=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Fh,base58flickr:Mh},Symbol.toStringTag,{value:"Module"})),jh=it({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bh=it({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),qh=it({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),zh=it({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),Kh=Object.freeze(Object.defineProperty({__proto__:null,base64:jh,base64pad:Bh,base64url:qh,base64urlpad:zh},Symbol.toStringTag,{value:"Module"})),ya=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Vh=ya.reduce((t,e,r)=>(t[r]=e,t),[]),Hh=ya.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Wh(t){return t.reduce((e,r)=>(e+=Vh[r],e),"")}function kh(t){const e=[];for(const r of t){const i=Hh[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Gh=Ci({prefix:"🚀",name:"base256emoji",encode:Wh,decode:kh}),Yh=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:Gh},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const Bs={...dh,...gh,...bh,...wh,...Eh,...Ph,...Uh,...$h,...Kh,...Yh};function ba(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const qs=ba("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Gi=ba("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=pa(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),_a={utf8:qs,"utf-8":qs,hex:Bs.base16,latin1:Gi,ascii:Gi,binary:Gi,...Bs};function yt(t,e="utf8"){const r=_a[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function _t(t,e="utf8"){const r=_a[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?In(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function _i(t){return yt(_t(Dn(t),Wl),da)}function wa(t){const e=_t(Ql,js),r=Xl+yt(ln([e,t]),js);return[Yl,Jl,r].join(Gl)}function Jh(t){return yt(t,da)}function Xh(t){return _t([_i(t.header),_i(t.payload)].join(fa),kl)}function Qh(t){return[_i(t.header),_i(t.payload),Jh(t.signature)].join(fa)}function zs(t=xr.randomBytes(Zl)){return Sn.generateKeyPairFromSeed(t)}async function Zh(t,e,r,i,n=Z.fromMiliseconds(Date.now())){const o={alg:Vl,typ:Hl},u=wa(i.publicKey),c=n+r,l={iss:u,sub:t,aud:e,iat:n,exp:c},y=Xh({header:o,payload:l}),d=Sn.sign(i.secretKey,y);return Qh({header:o,payload:l,signature:d})}var On={},Ti={};Object.defineProperty(Ti,"__esModule",{value:!0});var at=ne,hn=vt,ef=20;function tf(t,e,r){for(var i=1634760805,n=857760878,o=2036477234,u=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],l=r[7]<<24|r[6]<<16|r[5]<<8|r[4],y=r[11]<<24|r[10]<<16|r[9]<<8|r[8],d=r[15]<<24|r[14]<<16|r[13]<<8|r[12],I=r[19]<<24|r[18]<<16|r[17]<<8|r[16],N=r[23]<<24|r[22]<<16|r[21]<<8|r[20],O=r[27]<<24|r[26]<<16|r[25]<<8|r[24],x=r[31]<<24|r[30]<<16|r[29]<<8|r[28],U=e[3]<<24|e[2]<<16|e[1]<<8|e[0],M=e[7]<<24|e[6]<<16|e[5]<<8|e[4],H=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],T=i,b=n,v=o,f=u,s=c,h=l,$=y,w=d,D=I,S=N,L=O,p=x,_=U,z=M,j=H,q=E,F=0;F<ef;F+=2)T=T+s|0,_^=T,_=_>>>32-16|_<<16,D=D+_|0,s^=D,s=s>>>32-12|s<<12,b=b+h|0,z^=b,z=z>>>32-16|z<<16,S=S+z|0,h^=S,h=h>>>32-12|h<<12,v=v+$|0,j^=v,j=j>>>32-16|j<<16,L=L+j|0,$^=L,$=$>>>32-12|$<<12,f=f+w|0,q^=f,q=q>>>32-16|q<<16,p=p+q|0,w^=p,w=w>>>32-12|w<<12,v=v+$|0,j^=v,j=j>>>32-8|j<<8,L=L+j|0,$^=L,$=$>>>32-7|$<<7,f=f+w|0,q^=f,q=q>>>32-8|q<<8,p=p+q|0,w^=p,w=w>>>32-7|w<<7,b=b+h|0,z^=b,z=z>>>32-8|z<<8,S=S+z|0,h^=S,h=h>>>32-7|h<<7,T=T+s|0,_^=T,_=_>>>32-8|_<<8,D=D+_|0,s^=D,s=s>>>32-7|s<<7,T=T+h|0,q^=T,q=q>>>32-16|q<<16,L=L+q|0,h^=L,h=h>>>32-12|h<<12,b=b+$|0,_^=b,_=_>>>32-16|_<<16,p=p+_|0,$^=p,$=$>>>32-12|$<<12,v=v+w|0,z^=v,z=z>>>32-16|z<<16,D=D+z|0,w^=D,w=w>>>32-12|w<<12,f=f+s|0,j^=f,j=j>>>32-16|j<<16,S=S+j|0,s^=S,s=s>>>32-12|s<<12,v=v+w|0,z^=v,z=z>>>32-8|z<<8,D=D+z|0,w^=D,w=w>>>32-7|w<<7,f=f+s|0,j^=f,j=j>>>32-8|j<<8,S=S+j|0,s^=S,s=s>>>32-7|s<<7,b=b+$|0,_^=b,_=_>>>32-8|_<<8,p=p+_|0,$^=p,$=$>>>32-7|$<<7,T=T+h|0,q^=T,q=q>>>32-8|q<<8,L=L+q|0,h^=L,h=h>>>32-7|h<<7;at.writeUint32LE(T+i|0,t,0),at.writeUint32LE(b+n|0,t,4),at.writeUint32LE(v+o|0,t,8),at.writeUint32LE(f+u|0,t,12),at.writeUint32LE(s+c|0,t,16),at.writeUint32LE(h+l|0,t,20),at.writeUint32LE($+y|0,t,24),at.writeUint32LE(w+d|0,t,28),at.writeUint32LE(D+I|0,t,32),at.writeUint32LE(S+N|0,t,36),at.writeUint32LE(L+O|0,t,40),at.writeUint32LE(p+x|0,t,44),at.writeUint32LE(_+U|0,t,48),at.writeUint32LE(z+M|0,t,52),at.writeUint32LE(j+H|0,t,56),at.writeUint32LE(q+E|0,t,60)}function ma(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var o,u;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");o=new Uint8Array(16),u=o.length-e.length,o.set(e,u)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");o=e,u=n}for(var c=new Uint8Array(64),l=0;l<r.length;l+=64){tf(c,o,t);for(var y=l;y<l+64&&y<r.length;y++)i[y]=r[y]^c[y-l];nf(o,0,u)}return hn.wipe(c),n===0&&hn.wipe(o),i}Ti.streamXOR=ma;function rf(t,e,r,i){return i===void 0&&(i=0),hn.wipe(r),ma(t,e,r,r,i)}Ti.stream=rf;function nf(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var va={},Zt={};Object.defineProperty(Zt,"__esModule",{value:!0});function sf(t,e,r){return~(t-1)&e|t-1&r}Zt.select=sf;function of(t,e){return(t|0)-(e|0)-1>>>31&1}Zt.lessOrEqual=of;function Ea(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}Zt.compare=Ea;function af(t,e){return t.length===0||e.length===0?!1:Ea(t,e)!==0}Zt.equal=af;(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Zt,r=vt;t.DIGEST_LENGTH=16;var i=function(){function u(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var l=c[0]|c[1]<<8;this._r[0]=l&8191;var y=c[2]|c[3]<<8;this._r[1]=(l>>>13|y<<3)&8191;var d=c[4]|c[5]<<8;this._r[2]=(y>>>10|d<<6)&7939;var I=c[6]|c[7]<<8;this._r[3]=(d>>>7|I<<9)&8191;var N=c[8]|c[9]<<8;this._r[4]=(I>>>4|N<<12)&255,this._r[5]=N>>>1&8190;var O=c[10]|c[11]<<8;this._r[6]=(N>>>14|O<<2)&8191;var x=c[12]|c[13]<<8;this._r[7]=(O>>>11|x<<5)&8065;var U=c[14]|c[15]<<8;this._r[8]=(x>>>8|U<<8)&8191,this._r[9]=U>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return u.prototype._blocks=function(c,l,y){for(var d=this._fin?0:2048,I=this._h[0],N=this._h[1],O=this._h[2],x=this._h[3],U=this._h[4],M=this._h[5],H=this._h[6],E=this._h[7],T=this._h[8],b=this._h[9],v=this._r[0],f=this._r[1],s=this._r[2],h=this._r[3],$=this._r[4],w=this._r[5],D=this._r[6],S=this._r[7],L=this._r[8],p=this._r[9];y>=16;){var _=c[l+0]|c[l+1]<<8;I+=_&8191;var z=c[l+2]|c[l+3]<<8;N+=(_>>>13|z<<3)&8191;var j=c[l+4]|c[l+5]<<8;O+=(z>>>10|j<<6)&8191;var q=c[l+6]|c[l+7]<<8;x+=(j>>>7|q<<9)&8191;var F=c[l+8]|c[l+9]<<8;U+=(q>>>4|F<<12)&8191,M+=F>>>1&8191;var B=c[l+10]|c[l+11]<<8;H+=(F>>>14|B<<2)&8191;var V=c[l+12]|c[l+13]<<8;E+=(B>>>11|V<<5)&8191;var Q=c[l+14]|c[l+15]<<8;T+=(V>>>8|Q<<8)&8191,b+=Q>>>5|d;var W=0,ee=W;ee+=I*v,ee+=N*(5*p),ee+=O*(5*L),ee+=x*(5*S),ee+=U*(5*D),W=ee>>>13,ee&=8191,ee+=M*(5*w),ee+=H*(5*$),ee+=E*(5*h),ee+=T*(5*s),ee+=b*(5*f),W+=ee>>>13,ee&=8191;var Y=W;Y+=I*f,Y+=N*v,Y+=O*(5*p),Y+=x*(5*L),Y+=U*(5*S),W=Y>>>13,Y&=8191,Y+=M*(5*D),Y+=H*(5*w),Y+=E*(5*$),Y+=T*(5*h),Y+=b*(5*s),W+=Y>>>13,Y&=8191;var te=W;te+=I*s,te+=N*f,te+=O*v,te+=x*(5*p),te+=U*(5*L),W=te>>>13,te&=8191,te+=M*(5*S),te+=H*(5*D),te+=E*(5*w),te+=T*(5*$),te+=b*(5*h),W+=te>>>13,te&=8191;var R=W;R+=I*h,R+=N*s,R+=O*f,R+=x*v,R+=U*(5*p),W=R>>>13,R&=8191,R+=M*(5*L),R+=H*(5*S),R+=E*(5*D),R+=T*(5*w),R+=b*(5*$),W+=R>>>13,R&=8191;var P=W;P+=I*$,P+=N*h,P+=O*s,P+=x*f,P+=U*v,W=P>>>13,P&=8191,P+=M*(5*p),P+=H*(5*L),P+=E*(5*S),P+=T*(5*D),P+=b*(5*w),W+=P>>>13,P&=8191;var A=W;A+=I*w,A+=N*$,A+=O*h,A+=x*s,A+=U*f,W=A>>>13,A&=8191,A+=M*v,A+=H*(5*p),A+=E*(5*L),A+=T*(5*S),A+=b*(5*D),W+=A>>>13,A&=8191;var a=W;a+=I*D,a+=N*w,a+=O*$,a+=x*h,a+=U*s,W=a>>>13,a&=8191,a+=M*f,a+=H*v,a+=E*(5*p),a+=T*(5*L),a+=b*(5*S),W+=a>>>13,a&=8191;var m=W;m+=I*S,m+=N*D,m+=O*w,m+=x*$,m+=U*h,W=m>>>13,m&=8191,m+=M*s,m+=H*f,m+=E*v,m+=T*(5*p),m+=b*(5*L),W+=m>>>13,m&=8191;var k=W;k+=I*L,k+=N*S,k+=O*D,k+=x*w,k+=U*$,W=k>>>13,k&=8191,k+=M*h,k+=H*s,k+=E*f,k+=T*v,k+=b*(5*p),W+=k>>>13,k&=8191;var J=W;J+=I*p,J+=N*L,J+=O*S,J+=x*D,J+=U*w,W=J>>>13,J&=8191,J+=M*$,J+=H*h,J+=E*s,J+=T*f,J+=b*v,W+=J>>>13,J&=8191,W=(W<<2)+W|0,W=W+ee|0,ee=W&8191,W=W>>>13,Y+=W,I=ee,N=Y,O=te,x=R,U=P,M=A,H=a,E=m,T=k,b=J,l+=16,y-=16}this._h[0]=I,this._h[1]=N,this._h[2]=O,this._h[3]=x,this._h[4]=U,this._h[5]=M,this._h[6]=H,this._h[7]=E,this._h[8]=T,this._h[9]=b},u.prototype.finish=function(c,l){l===void 0&&(l=0);var y=new Uint16Array(10),d,I,N,O;if(this._leftover){for(O=this._leftover,this._buffer[O++]=1;O<16;O++)this._buffer[O]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(d=this._h[1]>>>13,this._h[1]&=8191,O=2;O<10;O++)this._h[O]+=d,d=this._h[O]>>>13,this._h[O]&=8191;for(this._h[0]+=d*5,d=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=d,d=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=d,y[0]=this._h[0]+5,d=y[0]>>>13,y[0]&=8191,O=1;O<10;O++)y[O]=this._h[O]+d,d=y[O]>>>13,y[O]&=8191;for(y[9]-=8192,I=(d^1)-1,O=0;O<10;O++)y[O]&=I;for(I=~I,O=0;O<10;O++)this._h[O]=this._h[O]&I|y[O];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,N=this._h[0]+this._pad[0],this._h[0]=N&65535,O=1;O<8;O++)N=(this._h[O]+this._pad[O]|0)+(N>>>16)|0,this._h[O]=N&65535;return c[l+0]=this._h[0]>>>0,c[l+1]=this._h[0]>>>8,c[l+2]=this._h[1]>>>0,c[l+3]=this._h[1]>>>8,c[l+4]=this._h[2]>>>0,c[l+5]=this._h[2]>>>8,c[l+6]=this._h[3]>>>0,c[l+7]=this._h[3]>>>8,c[l+8]=this._h[4]>>>0,c[l+9]=this._h[4]>>>8,c[l+10]=this._h[5]>>>0,c[l+11]=this._h[5]>>>8,c[l+12]=this._h[6]>>>0,c[l+13]=this._h[6]>>>8,c[l+14]=this._h[7]>>>0,c[l+15]=this._h[7]>>>8,this._finished=!0,this},u.prototype.update=function(c){var l=0,y=c.length,d;if(this._leftover){d=16-this._leftover,d>y&&(d=y);for(var I=0;I<d;I++)this._buffer[this._leftover+I]=c[l+I];if(y-=d,l+=d,this._leftover+=d,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(y>=16&&(d=y-y%16,this._blocks(c,l,d),l+=d,y-=d),y){for(var I=0;I<y;I++)this._buffer[this._leftover+I]=c[l+I];this._leftover+=y}return this},u.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},u.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},u}();t.Poly1305=i;function n(u,c){var l=new i(u);l.update(c);var y=l.digest();return l.clean(),y}t.oneTimeAuth=n;function o(u,c){return u.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(u,c)}t.equal=o})(va);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Ti,r=va,i=vt,n=ne,o=Zt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var u=new Uint8Array(16),c=function(){function l(y){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,y.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(y)}return l.prototype.seal=function(y,d,I,N){if(y.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var O=new Uint8Array(16);O.set(y,O.length-y.length);var x=new Uint8Array(32);e.stream(this._key,O,x,4);var U=d.length+this.tagLength,M;if(N){if(N.length!==U)throw new Error("ChaCha20Poly1305: incorrect destination length");M=N}else M=new Uint8Array(U);return e.streamXOR(this._key,O,d,M,4),this._authenticate(M.subarray(M.length-this.tagLength,M.length),x,M.subarray(0,M.length-this.tagLength),I),i.wipe(O),M},l.prototype.open=function(y,d,I,N){if(y.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(d.length<this.tagLength)return null;var O=new Uint8Array(16);O.set(y,O.length-y.length);var x=new Uint8Array(32);e.stream(this._key,O,x,4);var U=new Uint8Array(this.tagLength);if(this._authenticate(U,x,d.subarray(0,d.length-this.tagLength),I),!o.equal(U,d.subarray(d.length-this.tagLength,d.length)))return null;var M=d.length-this.tagLength,H;if(N){if(N.length!==M)throw new Error("ChaCha20Poly1305: incorrect destination length");H=N}else H=new Uint8Array(M);return e.streamXOR(this._key,O,d.subarray(0,d.length-this.tagLength),H,4),i.wipe(O),H},l.prototype.clean=function(){return i.wipe(this._key),this},l.prototype._authenticate=function(y,d,I,N){var O=new r.Poly1305(d);N&&(O.update(N),N.length%16>0&&O.update(u.subarray(N.length%16))),O.update(I),I.length%16>0&&O.update(u.subarray(I.length%16));var x=new Uint8Array(8);N&&n.writeUint64LE(N.length,x),O.update(x),n.writeUint64LE(I.length,x),O.update(x);for(var U=O.digest(),M=0;M<U.length;M++)y[M]=U[M];O.clean(),i.wipe(U),i.wipe(x)},l}();t.ChaCha20Poly1305=c})(On);var Da={},Qr={},xn={};Object.defineProperty(xn,"__esModule",{value:!0});function cf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}xn.isSerializableHash=cf;Object.defineProperty(Qr,"__esModule",{value:!0});var Ft=xn,uf=Zt,lf=vt,Sa=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),Ft.isSerializableHash(this._inner)&&Ft.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),lf.wipe(i)}return t.prototype.reset=function(){if(!Ft.isSerializableHash(this._inner)||!Ft.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Ft.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Ft.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Ft.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Ft.isSerializableHash(this._inner)||!Ft.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Ft.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Qr.HMAC=Sa;function hf(t,e,r){var i=new Sa(t,e);i.update(r);var n=i.digest();return i.clean(),n}Qr.hmac=hf;Qr.equal=uf.equal;Object.defineProperty(Da,"__esModule",{value:!0});var Ks=Qr,Vs=vt,ff=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var o=Ks.hmac(this._hash,i,r);this._hmac=new Ks.HMAC(e,o),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),Vs.wipe(this._buffer),Vs.wipe(this._counter),this._bufpos=0},t}(),df=Da.HKDF=ff,Ni={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ne,r=vt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(l,y){if(y===void 0&&(y=l.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var d=0;if(this._bytesHashed+=y,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&y>0;)this._buffer[this._bufferLength++]=l[d++],y--;this._bufferLength===this.blockSize&&(o(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(y>=this.blockSize&&(d=o(this._temp,this._state,l,d,y),y%=this.blockSize);y>0;)this._buffer[this._bufferLength++]=l[d++],y--;return this},c.prototype.finish=function(l){if(!this._finished){var y=this._bytesHashed,d=this._bufferLength,I=y/536870912|0,N=y<<3,O=y%64<56?64:128;this._buffer[d]=128;for(var x=d+1;x<O-8;x++)this._buffer[x]=0;e.writeUint32BE(I,this._buffer,O-8),e.writeUint32BE(N,this._buffer,O-4),o(this._temp,this._state,this._buffer,0,O),this._finished=!0}for(var x=0;x<this.digestLength/4;x++)e.writeUint32BE(this._state[x],l,x*4);return this},c.prototype.digest=function(){var l=new Uint8Array(this.digestLength);return this.finish(l),l},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(l){return this._state.set(l.state),this._bufferLength=l.bufferLength,l.buffer&&this._buffer.set(l.buffer),this._bytesHashed=l.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(l){r.wipe(l.state),l.buffer&&r.wipe(l.buffer),l.bufferLength=0,l.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function o(c,l,y,d,I){for(;I>=64;){for(var N=l[0],O=l[1],x=l[2],U=l[3],M=l[4],H=l[5],E=l[6],T=l[7],b=0;b<16;b++){var v=d+b*4;c[b]=e.readUint32BE(y,v)}for(var b=16;b<64;b++){var f=c[b-2],s=(f>>>17|f<<32-17)^(f>>>19|f<<32-19)^f>>>10;f=c[b-15];var h=(f>>>7|f<<32-7)^(f>>>18|f<<32-18)^f>>>3;c[b]=(s+c[b-7]|0)+(h+c[b-16]|0)}for(var b=0;b<64;b++){var s=(((M>>>6|M<<26)^(M>>>11|M<<21)^(M>>>25|M<<7))+(M&H^~M&E)|0)+(T+(n[b]+c[b]|0)|0)|0,h=((N>>>2|N<<32-2)^(N>>>13|N<<32-13)^(N>>>22|N<<32-22))+(N&O^N&x^O&x)|0;T=E,E=H,H=M,M=U+s|0,U=x,x=O,O=N,N=s+h|0}l[0]+=N,l[1]+=O,l[2]+=x,l[3]+=U,l[4]+=M,l[5]+=H,l[6]+=E,l[7]+=T,d+=64,I-=64}return d}function u(c){var l=new i;l.update(c);var y=l.digest();return l.clean(),y}t.hash=u})(Ni);var An={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=xr,r=vt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(b){const v=new Float64Array(16);if(b)for(let f=0;f<b.length;f++)v[f]=b[f];return v}const n=new Uint8Array(32);n[0]=9;const o=i([56129,1]);function u(b){let v=1;for(let f=0;f<16;f++){let s=b[f]+v+65535;v=Math.floor(s/65536),b[f]=s-v*65536}b[0]+=v-1+37*(v-1)}function c(b,v,f){const s=~(f-1);for(let h=0;h<16;h++){const $=s&(b[h]^v[h]);b[h]^=$,v[h]^=$}}function l(b,v){const f=i(),s=i();for(let h=0;h<16;h++)s[h]=v[h];u(s),u(s),u(s);for(let h=0;h<2;h++){f[0]=s[0]-65517;for(let w=1;w<15;w++)f[w]=s[w]-65535-(f[w-1]>>16&1),f[w-1]&=65535;f[15]=s[15]-32767-(f[14]>>16&1);const $=f[15]>>16&1;f[14]&=65535,c(s,f,1-$)}for(let h=0;h<16;h++)b[2*h]=s[h]&255,b[2*h+1]=s[h]>>8}function y(b,v){for(let f=0;f<16;f++)b[f]=v[2*f]+(v[2*f+1]<<8);b[15]&=32767}function d(b,v,f){for(let s=0;s<16;s++)b[s]=v[s]+f[s]}function I(b,v,f){for(let s=0;s<16;s++)b[s]=v[s]-f[s]}function N(b,v,f){let s,h,$=0,w=0,D=0,S=0,L=0,p=0,_=0,z=0,j=0,q=0,F=0,B=0,V=0,Q=0,W=0,ee=0,Y=0,te=0,R=0,P=0,A=0,a=0,m=0,k=0,J=0,he=0,be=0,de=0,ve=0,Fe=0,Ne=0,ye=f[0],pe=f[1],fe=f[2],ue=f[3],ce=f[4],ae=f[5],oe=f[6],re=f[7],le=f[8],ge=f[9],ie=f[10],_e=f[11],me=f[12],De=f[13],Se=f[14],Ee=f[15];s=v[0],$+=s*ye,w+=s*pe,D+=s*fe,S+=s*ue,L+=s*ce,p+=s*ae,_+=s*oe,z+=s*re,j+=s*le,q+=s*ge,F+=s*ie,B+=s*_e,V+=s*me,Q+=s*De,W+=s*Se,ee+=s*Ee,s=v[1],w+=s*ye,D+=s*pe,S+=s*fe,L+=s*ue,p+=s*ce,_+=s*ae,z+=s*oe,j+=s*re,q+=s*le,F+=s*ge,B+=s*ie,V+=s*_e,Q+=s*me,W+=s*De,ee+=s*Se,Y+=s*Ee,s=v[2],D+=s*ye,S+=s*pe,L+=s*fe,p+=s*ue,_+=s*ce,z+=s*ae,j+=s*oe,q+=s*re,F+=s*le,B+=s*ge,V+=s*ie,Q+=s*_e,W+=s*me,ee+=s*De,Y+=s*Se,te+=s*Ee,s=v[3],S+=s*ye,L+=s*pe,p+=s*fe,_+=s*ue,z+=s*ce,j+=s*ae,q+=s*oe,F+=s*re,B+=s*le,V+=s*ge,Q+=s*ie,W+=s*_e,ee+=s*me,Y+=s*De,te+=s*Se,R+=s*Ee,s=v[4],L+=s*ye,p+=s*pe,_+=s*fe,z+=s*ue,j+=s*ce,q+=s*ae,F+=s*oe,B+=s*re,V+=s*le,Q+=s*ge,W+=s*ie,ee+=s*_e,Y+=s*me,te+=s*De,R+=s*Se,P+=s*Ee,s=v[5],p+=s*ye,_+=s*pe,z+=s*fe,j+=s*ue,q+=s*ce,F+=s*ae,B+=s*oe,V+=s*re,Q+=s*le,W+=s*ge,ee+=s*ie,Y+=s*_e,te+=s*me,R+=s*De,P+=s*Se,A+=s*Ee,s=v[6],_+=s*ye,z+=s*pe,j+=s*fe,q+=s*ue,F+=s*ce,B+=s*ae,V+=s*oe,Q+=s*re,W+=s*le,ee+=s*ge,Y+=s*ie,te+=s*_e,R+=s*me,P+=s*De,A+=s*Se,a+=s*Ee,s=v[7],z+=s*ye,j+=s*pe,q+=s*fe,F+=s*ue,B+=s*ce,V+=s*ae,Q+=s*oe,W+=s*re,ee+=s*le,Y+=s*ge,te+=s*ie,R+=s*_e,P+=s*me,A+=s*De,a+=s*Se,m+=s*Ee,s=v[8],j+=s*ye,q+=s*pe,F+=s*fe,B+=s*ue,V+=s*ce,Q+=s*ae,W+=s*oe,ee+=s*re,Y+=s*le,te+=s*ge,R+=s*ie,P+=s*_e,A+=s*me,a+=s*De,m+=s*Se,k+=s*Ee,s=v[9],q+=s*ye,F+=s*pe,B+=s*fe,V+=s*ue,Q+=s*ce,W+=s*ae,ee+=s*oe,Y+=s*re,te+=s*le,R+=s*ge,P+=s*ie,A+=s*_e,a+=s*me,m+=s*De,k+=s*Se,J+=s*Ee,s=v[10],F+=s*ye,B+=s*pe,V+=s*fe,Q+=s*ue,W+=s*ce,ee+=s*ae,Y+=s*oe,te+=s*re,R+=s*le,P+=s*ge,A+=s*ie,a+=s*_e,m+=s*me,k+=s*De,J+=s*Se,he+=s*Ee,s=v[11],B+=s*ye,V+=s*pe,Q+=s*fe,W+=s*ue,ee+=s*ce,Y+=s*ae,te+=s*oe,R+=s*re,P+=s*le,A+=s*ge,a+=s*ie,m+=s*_e,k+=s*me,J+=s*De,he+=s*Se,be+=s*Ee,s=v[12],V+=s*ye,Q+=s*pe,W+=s*fe,ee+=s*ue,Y+=s*ce,te+=s*ae,R+=s*oe,P+=s*re,A+=s*le,a+=s*ge,m+=s*ie,k+=s*_e,J+=s*me,he+=s*De,be+=s*Se,de+=s*Ee,s=v[13],Q+=s*ye,W+=s*pe,ee+=s*fe,Y+=s*ue,te+=s*ce,R+=s*ae,P+=s*oe,A+=s*re,a+=s*le,m+=s*ge,k+=s*ie,J+=s*_e,he+=s*me,be+=s*De,de+=s*Se,ve+=s*Ee,s=v[14],W+=s*ye,ee+=s*pe,Y+=s*fe,te+=s*ue,R+=s*ce,P+=s*ae,A+=s*oe,a+=s*re,m+=s*le,k+=s*ge,J+=s*ie,he+=s*_e,be+=s*me,de+=s*De,ve+=s*Se,Fe+=s*Ee,s=v[15],ee+=s*ye,Y+=s*pe,te+=s*fe,R+=s*ue,P+=s*ce,A+=s*ae,a+=s*oe,m+=s*re,k+=s*le,J+=s*ge,he+=s*ie,be+=s*_e,de+=s*me,ve+=s*De,Fe+=s*Se,Ne+=s*Ee,$+=38*Y,w+=38*te,D+=38*R,S+=38*P,L+=38*A,p+=38*a,_+=38*m,z+=38*k,j+=38*J,q+=38*he,F+=38*be,B+=38*de,V+=38*ve,Q+=38*Fe,W+=38*Ne,h=1,s=$+h+65535,h=Math.floor(s/65536),$=s-h*65536,s=w+h+65535,h=Math.floor(s/65536),w=s-h*65536,s=D+h+65535,h=Math.floor(s/65536),D=s-h*65536,s=S+h+65535,h=Math.floor(s/65536),S=s-h*65536,s=L+h+65535,h=Math.floor(s/65536),L=s-h*65536,s=p+h+65535,h=Math.floor(s/65536),p=s-h*65536,s=_+h+65535,h=Math.floor(s/65536),_=s-h*65536,s=z+h+65535,h=Math.floor(s/65536),z=s-h*65536,s=j+h+65535,h=Math.floor(s/65536),j=s-h*65536,s=q+h+65535,h=Math.floor(s/65536),q=s-h*65536,s=F+h+65535,h=Math.floor(s/65536),F=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,s=W+h+65535,h=Math.floor(s/65536),W=s-h*65536,s=ee+h+65535,h=Math.floor(s/65536),ee=s-h*65536,$+=h-1+37*(h-1),h=1,s=$+h+65535,h=Math.floor(s/65536),$=s-h*65536,s=w+h+65535,h=Math.floor(s/65536),w=s-h*65536,s=D+h+65535,h=Math.floor(s/65536),D=s-h*65536,s=S+h+65535,h=Math.floor(s/65536),S=s-h*65536,s=L+h+65535,h=Math.floor(s/65536),L=s-h*65536,s=p+h+65535,h=Math.floor(s/65536),p=s-h*65536,s=_+h+65535,h=Math.floor(s/65536),_=s-h*65536,s=z+h+65535,h=Math.floor(s/65536),z=s-h*65536,s=j+h+65535,h=Math.floor(s/65536),j=s-h*65536,s=q+h+65535,h=Math.floor(s/65536),q=s-h*65536,s=F+h+65535,h=Math.floor(s/65536),F=s-h*65536,s=B+h+65535,h=Math.floor(s/65536),B=s-h*65536,s=V+h+65535,h=Math.floor(s/65536),V=s-h*65536,s=Q+h+65535,h=Math.floor(s/65536),Q=s-h*65536,s=W+h+65535,h=Math.floor(s/65536),W=s-h*65536,s=ee+h+65535,h=Math.floor(s/65536),ee=s-h*65536,$+=h-1+37*(h-1),b[0]=$,b[1]=w,b[2]=D,b[3]=S,b[4]=L,b[5]=p,b[6]=_,b[7]=z,b[8]=j,b[9]=q,b[10]=F,b[11]=B,b[12]=V,b[13]=Q,b[14]=W,b[15]=ee}function O(b,v){N(b,v,v)}function x(b,v){const f=i();for(let s=0;s<16;s++)f[s]=v[s];for(let s=253;s>=0;s--)O(f,f),s!==2&&s!==4&&N(f,f,v);for(let s=0;s<16;s++)b[s]=f[s]}function U(b,v){const f=new Uint8Array(32),s=new Float64Array(80),h=i(),$=i(),w=i(),D=i(),S=i(),L=i();for(let j=0;j<31;j++)f[j]=b[j];f[31]=b[31]&127|64,f[0]&=248,y(s,v);for(let j=0;j<16;j++)$[j]=s[j];h[0]=D[0]=1;for(let j=254;j>=0;--j){const q=f[j>>>3]>>>(j&7)&1;c(h,$,q),c(w,D,q),d(S,h,w),I(h,h,w),d(w,$,D),I($,$,D),O(D,S),O(L,h),N(h,w,h),N(w,$,S),d(S,h,w),I(h,h,w),O($,h),I(w,D,L),N(h,w,o),d(h,h,D),N(w,w,h),N(h,D,L),N(D,$,s),O($,S),c(h,$,q),c(w,D,q)}for(let j=0;j<16;j++)s[j+16]=h[j],s[j+32]=w[j],s[j+48]=$[j],s[j+64]=D[j];const p=s.subarray(32),_=s.subarray(16);x(p,p),N(_,_,p);const z=new Uint8Array(32);return l(z,_),z}t.scalarMult=U;function M(b){return U(b,n)}t.scalarMultBase=M;function H(b){if(b.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const v=new Uint8Array(b);return{publicKey:M(v),secretKey:v}}t.generateKeyPairFromSeed=H;function E(b){const v=(0,e.randomBytes)(32,b),f=H(v);return(0,r.wipe)(v),f}t.generateKeyPair=E;function T(b,v,f=!1){if(b.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(v.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const s=U(b,v);if(f){let h=0;for(let $=0;$<s.length;$++)h|=s[$];if(h===0)throw new Error("X25519: invalid shared key")}return s}t.sharedKey=T})(An);var Hs=globalThis&&globalThis.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,o;i<n;i++)(o||!(i in e))&&(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))},pf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),gf=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),yf=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),bf=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),_f=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),wf=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,mf=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Ws=3,vf=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",wf]],ks=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ef(t){return t?Gs(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new _f:typeof navigator<"u"?Gs(navigator.userAgent):If()}function Df(t){return t!==""&&vf.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var o=n.exec(t);return!!o&&[i,o]},!1)}function Gs(t){var e=Df(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new bf;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Ws&&(n=Hs(Hs([],n,!0),Of(Ws-n.length),!0)):n=[];var o=n.join("."),u=Sf(t),c=mf.exec(t);return c&&c[1]?new yf(r,o,u,c[1]):new pf(r,o,u)}function Sf(t){for(var e=0,r=ks.length;e<r;e++){var i=ks[e],n=i[0],o=i[1],u=o.exec(t);if(u)return n}return null}function If(){var t=typeof process<"u"&&process.version;return t?new gf(process.version.slice(1)):null}function Of(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Oe={};Object.defineProperty(Oe,"__esModule",{value:!0});Oe.getLocalStorage=Oe.getLocalStorageOrThrow=Oe.getCrypto=Oe.getCryptoOrThrow=Oa=Oe.getLocation=Oe.getLocationOrThrow=Cn=Oe.getNavigator=Oe.getNavigatorOrThrow=Ia=Oe.getDocument=Oe.getDocumentOrThrow=Oe.getFromWindowOrThrow=Oe.getFromWindow=void 0;function gr(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Oe.getFromWindow=gr;function Ar(t){const e=gr(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Oe.getFromWindowOrThrow=Ar;function xf(){return Ar("document")}Oe.getDocumentOrThrow=xf;function Af(){return gr("document")}var Ia=Oe.getDocument=Af;function Cf(){return Ar("navigator")}Oe.getNavigatorOrThrow=Cf;function Tf(){return gr("navigator")}var Cn=Oe.getNavigator=Tf;function Nf(){return Ar("location")}Oe.getLocationOrThrow=Nf;function Pf(){return gr("location")}var Oa=Oe.getLocation=Pf;function Rf(){return Ar("crypto")}Oe.getCryptoOrThrow=Rf;function Lf(){return gr("crypto")}Oe.getCrypto=Lf;function Uf(){return Ar("localStorage")}Oe.getLocalStorageOrThrow=Uf;function Ff(){return gr("localStorage")}Oe.getLocalStorage=Ff;var Tn={};Object.defineProperty(Tn,"__esModule",{value:!0});var xa=Tn.getWindowMetadata=void 0;const Ys=Oe;function Mf(){let t,e;try{t=Ys.getDocumentOrThrow(),e=Ys.getLocationOrThrow()}catch{return null}function r(){const I=t.getElementsByTagName("link"),N=[];for(let O=0;O<I.length;O++){const x=I[O],U=x.getAttribute("rel");if(U&&U.toLowerCase().indexOf("icon")>-1){const M=x.getAttribute("href");if(M)if(M.toLowerCase().indexOf("https:")===-1&&M.toLowerCase().indexOf("http:")===-1&&M.indexOf("//")!==0){let H=e.protocol+"//"+e.host;if(M.indexOf("/")===0)H+=M;else{const E=e.pathname.split("/");E.pop();const T=E.join("/");H+=T+"/"+M}N.push(H)}else if(M.indexOf("//")===0){const H=e.protocol+M;N.push(H)}else N.push(M)}}return N}function i(...I){const N=t.getElementsByTagName("meta");for(let O=0;O<N.length;O++){const x=N[O],U=["itemprop","property","name"].map(M=>x.getAttribute(M)).filter(M=>M?I.includes(M):!1);if(U.length&&U){const M=x.getAttribute("content");if(M)return M}}return""}function n(){let I=i("name","og:site_name","og:title","twitter:title");return I||(I=t.title),I}function o(){return i("description","og:description","twitter:description","keywords")}const u=n(),c=o(),l=e.origin,y=r();return{description:c,url:l,icons:y,name:u}}xa=Tn.getWindowMetadata=Mf;var Yr={},$f=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Aa="%[a-f0-9]{2}",Js=new RegExp("("+Aa+")|([^%]+?)","gi"),Xs=new RegExp("("+Aa+")+","gi");function fn(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],fn(r),fn(i))}function jf(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(Js)||[],r=1;r<e.length;r++)t=fn(e,r).join(""),e=t.match(Js)||[];return t}}function Bf(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},r=Xs.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=jf(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Xs.exec(t)}e["%C2"]="�";for(var n=Object.keys(e),o=0;o<n.length;o++){var u=n[o];t=t.replace(new RegExp(u,"g"),e[u])}return t}var qf=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Bf(t)}},zf=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},Kf=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),o=0;o<i.length;o++){var u=i[o],c=t[u];(n?e.indexOf(u)!==-1:e(u,c,t))&&(r[u]=c)}return r};(function(t){const e=$f,r=qf,i=zf,n=Kf,o=E=>E==null,u=Symbol("encodeFragmentIdentifier");function c(E){switch(E.arrayFormat){case"index":return T=>(b,v)=>{const f=b.length;return v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?b:v===null?[...b,[d(T,E),"[",f,"]"].join("")]:[...b,[d(T,E),"[",d(f,E),"]=",d(v,E)].join("")]};case"bracket":return T=>(b,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?b:v===null?[...b,[d(T,E),"[]"].join("")]:[...b,[d(T,E),"[]=",d(v,E)].join("")];case"colon-list-separator":return T=>(b,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?b:v===null?[...b,[d(T,E),":list="].join("")]:[...b,[d(T,E),":list=",d(v,E)].join("")];case"comma":case"separator":case"bracket-separator":{const T=E.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(v,f)=>f===void 0||E.skipNull&&f===null||E.skipEmptyString&&f===""?v:(f=f===null?"":f,v.length===0?[[d(b,E),T,d(f,E)].join("")]:[[v,d(f,E)].join(E.arrayFormatSeparator)])}default:return T=>(b,v)=>v===void 0||E.skipNull&&v===null||E.skipEmptyString&&v===""?b:v===null?[...b,d(T,E)]:[...b,[d(T,E),"=",d(v,E)].join("")]}}function l(E){let T;switch(E.arrayFormat){case"index":return(b,v,f)=>{if(T=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!T){f[b]=v;return}f[b]===void 0&&(f[b]={}),f[b][T[1]]=v};case"bracket":return(b,v,f)=>{if(T=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!T){f[b]=v;return}if(f[b]===void 0){f[b]=[v];return}f[b]=[].concat(f[b],v)};case"colon-list-separator":return(b,v,f)=>{if(T=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!T){f[b]=v;return}if(f[b]===void 0){f[b]=[v];return}f[b]=[].concat(f[b],v)};case"comma":case"separator":return(b,v,f)=>{const s=typeof v=="string"&&v.includes(E.arrayFormatSeparator),h=typeof v=="string"&&!s&&I(v,E).includes(E.arrayFormatSeparator);v=h?I(v,E):v;const $=s||h?v.split(E.arrayFormatSeparator).map(w=>I(w,E)):v===null?v:I(v,E);f[b]=$};case"bracket-separator":return(b,v,f)=>{const s=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!s){f[b]=v&&I(v,E);return}const h=v===null?[]:v.split(E.arrayFormatSeparator).map($=>I($,E));if(f[b]===void 0){f[b]=h;return}f[b]=[].concat(f[b],h)};default:return(b,v,f)=>{if(f[b]===void 0){f[b]=v;return}f[b]=[].concat(f[b],v)}}}function y(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function d(E,T){return T.encode?T.strict?e(E):encodeURIComponent(E):E}function I(E,T){return T.decode?r(E):E}function N(E){return Array.isArray(E)?E.sort():typeof E=="object"?N(Object.keys(E)).sort((T,b)=>Number(T)-Number(b)).map(T=>E[T]):E}function O(E){const T=E.indexOf("#");return T!==-1&&(E=E.slice(0,T)),E}function x(E){let T="";const b=E.indexOf("#");return b!==-1&&(T=E.slice(b)),T}function U(E){E=O(E);const T=E.indexOf("?");return T===-1?"":E.slice(T+1)}function M(E,T){return T.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):T.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function H(E,T){T=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},T),y(T.arrayFormatSeparator);const b=l(T),v=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return v;for(const f of E.split("&")){if(f==="")continue;let[s,h]=i(T.decode?f.replace(/\+/g," "):f,"=");h=h===void 0?null:["comma","separator","bracket-separator"].includes(T.arrayFormat)?h:I(h,T),b(I(s,T),h,v)}for(const f of Object.keys(v)){const s=v[f];if(typeof s=="object"&&s!==null)for(const h of Object.keys(s))s[h]=M(s[h],T);else v[f]=M(s,T)}return T.sort===!1?v:(T.sort===!0?Object.keys(v).sort():Object.keys(v).sort(T.sort)).reduce((f,s)=>{const h=v[s];return h&&typeof h=="object"&&!Array.isArray(h)?f[s]=N(h):f[s]=h,f},Object.create(null))}t.extract=U,t.parse=H,t.stringify=(E,T)=>{if(!E)return"";T=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},T),y(T.arrayFormatSeparator);const b=h=>T.skipNull&&o(E[h])||T.skipEmptyString&&E[h]==="",v=c(T),f={};for(const h of Object.keys(E))b(h)||(f[h]=E[h]);const s=Object.keys(f);return T.sort!==!1&&s.sort(T.sort),s.map(h=>{const $=E[h];return $===void 0?"":$===null?d(h,T):Array.isArray($)?$.length===0&&T.arrayFormat==="bracket-separator"?d(h,T)+"[]":$.reduce(v(h),[]).join("&"):d(h,T)+"="+d($,T)}).filter(h=>h.length>0).join("&")},t.parseUrl=(E,T)=>{T=Object.assign({decode:!0},T);const[b,v]=i(E,"#");return Object.assign({url:b.split("?")[0]||"",query:H(U(E),T)},T&&T.parseFragmentIdentifier&&v?{fragmentIdentifier:I(v,T)}:{})},t.stringifyUrl=(E,T)=>{T=Object.assign({encode:!0,strict:!0,[u]:!0},T);const b=O(E.url).split("?")[0]||"",v=t.extract(E.url),f=t.parse(v,{sort:!1}),s=Object.assign(f,E.query);let h=t.stringify(s,T);h&&(h=`?${h}`);let $=x(E.url);return E.fragmentIdentifier&&($=`#${T[u]?d(E.fragmentIdentifier,T):E.fragmentIdentifier}`),`${b}${h}${$}`},t.pick=(E,T,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[u]:!1},b);const{url:v,query:f,fragmentIdentifier:s}=t.parseUrl(E,b);return t.stringifyUrl({url:v,query:n(f,T),fragmentIdentifier:s},b)},t.exclude=(E,T,b)=>{const v=Array.isArray(T)?f=>!T.includes(f):(f,s)=>!T(f,s);return t.pick(E,v,b)}})(Yr);const Vf={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Ca(t,e){return t.includes(":")?[t]:e.chains||[]}const Ta="base10",gt="base16",dn="base64pad",Nn="utf8",Na=0,yr=1,Hf=0,Qs=1,pn=12,Pn=32;function Wf(){const t=An.generateKeyPair();return{privateKey:yt(t.secretKey,gt),publicKey:yt(t.publicKey,gt)}}function gn(){const t=xr.randomBytes(Pn);return yt(t,gt)}function kf(t,e){const r=An.sharedKey(_t(t,gt),_t(e,gt)),i=new df(Ni.SHA256,r).expand(Pn);return yt(i,gt)}function Gf(t){const e=Ni.hash(_t(t,gt));return yt(e,gt)}function Sr(t){const e=Ni.hash(_t(t,Nn));return yt(e,gt)}function Yf(t){return _t(`${t}`,Ta)}function Zr(t){return Number(yt(t,Ta))}function Jf(t){const e=Yf(typeof t.type<"u"?t.type:Na);if(Zr(e)===yr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?_t(t.senderPublicKey,gt):void 0,i=typeof t.iv<"u"?_t(t.iv,gt):xr.randomBytes(pn),n=new On.ChaCha20Poly1305(_t(t.symKey,gt)).seal(i,_t(t.message,Nn));return Qf({type:e,sealed:n,iv:i,senderPublicKey:r})}function Xf(t){const e=new On.ChaCha20Poly1305(_t(t.symKey,gt)),{sealed:r,iv:i}=wi(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return yt(n,Nn)}function Qf(t){if(Zr(t.type)===yr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return yt(ln([t.type,t.senderPublicKey,t.iv,t.sealed]),dn)}return yt(ln([t.type,t.iv,t.sealed]),dn)}function wi(t){const e=_t(t,dn),r=e.slice(Hf,Qs),i=Qs;if(Zr(r)===yr){const c=i+Pn,l=c+pn,y=e.slice(i,c),d=e.slice(c,l),I=e.slice(l);return{type:r,sealed:I,iv:d,senderPublicKey:y}}const n=i+pn,o=e.slice(i,n),u=e.slice(n);return{type:r,sealed:u,iv:o}}function Zf(t,e){const r=wi(t);return Pa({type:Zr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?yt(r.senderPublicKey,gt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function Pa(t){const e=(t==null?void 0:t.type)||Na;if(e===yr){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function Zs(t){return t.type===yr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var ed=Object.defineProperty,eo=Object.getOwnPropertySymbols,td=Object.prototype.hasOwnProperty,rd=Object.prototype.propertyIsEnumerable,to=(t,e,r)=>e in t?ed(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ro=(t,e)=>{for(var r in e||(e={}))td.call(e,r)&&to(t,r,e[r]);if(eo)for(var r of eo(e))rd.call(e,r)&&to(t,r,e[r]);return t};const id="ReactNative",Jt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},nd="js";function Rn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ra(){return!Ia()&&!!Cn()&&navigator.product===id}function Ln(){return!Rn()&&!!Cn()}function Un(){return Ra()?Jt.reactNative:Rn()?Jt.node:Ln()?Jt.browser:Jt.unknown}function sd(t,e){let r=Yr.parse(t);return r=ro(ro({},r),e),t=Yr.stringify(r),t}function od(){return xa()||{name:"",description:"",url:"",icons:[""]}}function ad(){if(Un()===Jt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Ef();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function cd(){var t;const e=Un();return e===Jt.browser?[e,((t=Oa())==null?void 0:t.host)||"unknown"].join(":"):e}function ud(t,e,r){const i=ad(),n=cd();return[[t,e].join("-"),[nd,r].join("-"),i,n].join("/")}function ld({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:o,useOnCloseEvent:u}){const c=r.split("?"),l=ud(t,e,i),y={auth:n,ua:l,projectId:o,useOnCloseEvent:u||void 0},d=sd(c[1]||"",y);return c[0]+"?"+d}function fr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function La(t){return Object.fromEntries(t.entries())}function Ua(t){return new Map(Object.entries(t))}function vr(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let i,n,o;return{resolve:u=>{o&&i&&(clearTimeout(o),i(u))},reject:u=>{o&&n&&(clearTimeout(o),n(u))},done:()=>new Promise((u,c)=>{o=setTimeout(()=>{c(new Error(e))},r),i=u,n=c})}}function mi(t,e,r){return new Promise(async(i,n)=>{const o=setTimeout(()=>n(new Error(r)),e);try{const u=await t;i(u)}catch(u){n(u)}clearTimeout(o)})}function Fa(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function hd(t){return Fa("topic",t)}function fd(t){return Fa("id",t)}function Ma(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Ct(t,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(t))}function Yt(t){return Date.now()>=Z.toMiliseconds(t)}function ze(t,e){return`${t}${e?`:${e}`:""}`}async function dd({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let n=i==null?void 0:i.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const o=`${n}/wc?requestId=${t}&sessionTopic=${e}`,u=Un();u===Jt.browser?o.startsWith("https://")?window.open(o,"_blank","noreferrer noopener"):window.open(o,"_self","noreferrer noopener"):u===Jt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}const pd="irn";function yn(t){return(t==null?void 0:t.relay)||{protocol:pd}}function pi(t){const e=Vf[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var gd=Object.defineProperty,io=Object.getOwnPropertySymbols,yd=Object.prototype.hasOwnProperty,bd=Object.prototype.propertyIsEnumerable,no=(t,e,r)=>e in t?gd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_d=(t,e)=>{for(var r in e||(e={}))yd.call(e,r)&&no(t,r,e[r]);if(io)for(var r of io(e))bd.call(e,r)&&no(t,r,e[r]);return t};function wd(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const o=n.replace(i,""),u=t[n];r[o]=u}}),r}function md(t){const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),o=typeof r<"u"?t.substring(r):"",u=Yr.parse(o);return{protocol:i,topic:vd(n[0]),version:parseInt(n[1],10),symKey:u.symKey,relay:wd(u)}}function vd(t){return t.startsWith("//")?t.substring(2):t}function Ed(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const o=r+e+n;t[n]&&(i[o]=t[n])}),i}function Dd(t){return`${t.protocol}:${t.topic}@${t.version}?`+Yr.stringify(_d({symKey:t.symKey},Ed(t.relay)))}function Cr(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function Sd(t){const e=[];return Object.values(t).forEach(r=>{e.push(...Cr(r.accounts))}),e}function Id(t,e){const r=[];return Object.values(t).forEach(i=>{Cr(i.accounts).includes(e)&&r.push(...i.methods)}),r}function Od(t,e){const r=[];return Object.values(t).forEach(i=>{Cr(i.accounts).includes(e)&&r.push(...i.events)}),r}function xd(t,e){const r=gi(t,e);if(r)throw new Error(r.message);const i={};for(const[n,o]of Object.entries(t))i[n]={methods:o.methods,events:o.events,chains:o.accounts.map(u=>`${u.split(":")[0]}:${u.split(":")[1]}`)};return i}const Ad={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Cd={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function G(t,e){const{message:r,code:i}=Cd[t];return{message:e?`${r} ${e}`:r,code:i}}function et(t,e){const{message:r,code:i}=Ad[t];return{message:e?`${r} ${e}`:r,code:i}}function ei(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function kr(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function pt(t){return typeof t>"u"}function tt(t,e){return e&&pt(t)?!0:typeof t=="string"&&!!t.trim().length}function Fn(t,e){return e&&pt(t)?!0:typeof t=="number"&&!isNaN(t)}function Td(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let o=!0;return fr(n,i)?(i.forEach(u=>{const{accounts:c,methods:l,events:y}=t.namespaces[u],d=Cr(c),I=r[u];(!fr(Ca(u,I),d)||!fr(I.methods,l)||!fr(I.events,y))&&(o=!1)}),o):!1}function vi(t){return tt(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Nd(t){if(tt(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&vi(r)}}return!1}function Pd(t){if(tt(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Rd(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function Ld(t){return t==null?void 0:t.topic}function Ud(t,e){let r=null;return tt(t==null?void 0:t.publicKey,!1)||(r=G("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function so(t){let e=!0;return ei(t)?t.length&&(e=t.every(r=>tt(r,!1))):e=!1,e}function Fd(t,e,r){let i=null;return ei(e)&&e.length?e.forEach(n=>{i||vi(n)||(i=et("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):vi(t)||(i=et("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Md(t,e,r){let i=null;return Object.entries(t).forEach(([n,o])=>{if(i)return;const u=Fd(n,Ca(n,o),`${e} ${r}`);u&&(i=u)}),i}function $d(t,e){let r=null;return ei(t)?t.forEach(i=>{r||Nd(i)||(r=et("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=et("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function jd(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=$d(i==null?void 0:i.accounts,`${e} namespace`);n&&(r=n)}),r}function Bd(t,e){let r=null;return so(t==null?void 0:t.methods)?so(t==null?void 0:t.events)||(r=et("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=et("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function $a(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Bd(i,`${e}, namespace`);n&&(r=n)}),r}function qd(t,e,r){let i=null;if(t&&kr(t)){const n=$a(t,e);n&&(i=n);const o=Md(t,e,r);o&&(i=o)}else i=G("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function gi(t,e){let r=null;if(t&&kr(t)){const i=$a(t,e);i&&(r=i);const n=jd(t,e);n&&(r=n)}else r=G("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function ja(t){return tt(t.protocol,!0)}function zd(t,e){let r=!1;return e&&!t?r=!0:t&&ei(t)&&t.length&&t.forEach(i=>{r=ja(i)}),r}function Kd(t){return typeof t=="number"}function bt(t){return typeof t<"u"&&typeof t!==null}function Vd(t){return!(!t||typeof t!="object"||!t.code||!Fn(t.code,!1)||!t.message||!tt(t.message,!1))}function Hd(t){return!(pt(t)||!tt(t.method,!1))}function Wd(t){return!(pt(t)||pt(t.result)&&pt(t.error)||!Fn(t.id,!1)||!tt(t.jsonrpc,!1))}function kd(t){return!(pt(t)||!tt(t.name,!1))}function oo(t,e){return!(!vi(e)||!Sd(t).includes(e))}function Gd(t,e,r){return tt(r,!1)?Id(t,e).includes(r):!1}function Yd(t,e,r){return tt(r,!1)?Od(t,e).includes(r):!1}function ao(t,e,r){let i=null;const n=Jd(t),o=Xd(e),u=Object.keys(n),c=Object.keys(o),l=co(Object.keys(t)),y=co(Object.keys(e)),d=l.filter(I=>!y.includes(I));return d.length&&(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),fr(u,c)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${u.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(I=>{if(!I.includes(":")||i)return;const N=Cr(e[I].accounts);N.includes(I)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${I}
        Required: ${I}
        Approved: ${N.toString()}`))}),u.forEach(I=>{i||(fr(n[I].methods,o[I].methods)?fr(n[I].events,o[I].events)||(i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${I}`)):i=G("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${I}`))}),i}function Jd(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function co(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function Xd(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=Cr(t[r].accounts);i==null||i.forEach(n=>{e[n]={accounts:t[r].accounts.filter(o=>o.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function Qd(t,e){return Fn(t,!1)&&t<=e.max&&t>=e.min}const Zd="PARSE_ERROR",ep="INVALID_REQUEST",tp="METHOD_NOT_FOUND",rp="INVALID_PARAMS",Ba="INTERNAL_ERROR",Mn="SERVER_ERROR",ip=[-32700,-32600,-32601,-32602,-32603],Gr={[Zd]:{code:-32700,message:"Parse error"},[ep]:{code:-32600,message:"Invalid Request"},[tp]:{code:-32601,message:"Method not found"},[rp]:{code:-32602,message:"Invalid params"},[Ba]:{code:-32603,message:"Internal error"},[Mn]:{code:-32e3,message:"Server error"}},qa=Mn;function np(t){return ip.includes(t)}function uo(t){return Object.keys(Gr).includes(t)?Gr[t]:Gr[qa]}function sp(t){const e=Object.values(Gr).find(r=>r.code===t);return e||Gr[qa]}function op(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var za={},qt={},lo;function ap(){if(lo)return qt;lo=1,Object.defineProperty(qt,"__esModule",{value:!0}),qt.isBrowserCryptoAvailable=qt.getSubtleCrypto=qt.getBrowerCrypto=void 0;function t(){return(dt==null?void 0:dt.crypto)||(dt==null?void 0:dt.msCrypto)||{}}qt.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}qt.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return qt.isBrowserCryptoAvailable=r,qt}var zt={},ho;function cp(){if(ho)return zt;ho=1,Object.defineProperty(zt,"__esModule",{value:!0}),zt.isBrowser=zt.isNode=zt.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}zt.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}zt.isNode=e;function r(){return!t()&&!e()}return zt.isBrowser=r,zt}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ot;e.__exportStar(ap(),t),e.__exportStar(cp(),t)})(za);function Ka(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function $n(t=6){return BigInt(Ka(t))}function Pi(t,e,r){return{id:r||Ka(),jsonrpc:"2.0",method:t,params:e}}function jn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function Bn(t,e,r){return{id:t,jsonrpc:"2.0",error:up(e,r)}}function up(t,e){return typeof t>"u"?uo(Ba):(typeof t=="string"&&(t=Object.assign(Object.assign({},uo(Mn)),{message:t})),typeof e<"u"&&(t.data=e),np(t.code)&&(t=sp(t.code)),t)}class lp{}class hp extends lp{constructor(){super()}}class fp extends hp{constructor(e){super()}}const dp="^wss?:";function pp(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function gp(t,e){const r=pp(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function fo(t){return gp(t,dp)}function yp(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function Va(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function qn(t){return Va(t)&&"method"in t}function Ri(t){return Va(t)&&(Kt(t)||Tt(t))}function Kt(t){return"result"in t}function Tt(t){return"error"in t}class bp extends fp{constructor(e){super(e),this.events=new Pt.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(Pi(e.method,e.params||[],e.id||$n().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(o){n(o)}this.events.on(`${e.id}`,o=>{Tt(o)?n(o.error):i(o.result)});try{await this.connection.send(e,r)}catch(o){n(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Ri(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const _p=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),wp=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",po=t=>t.split("?")[0],go=10,mp=_p();class vp{constructor(e){if(this.url=e,this.events=new Pt.EventEmitter,this.registering=!1,!fo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Dn(e))}catch(i){this.onError(e.id,i)}}register(e=this.url){if(!fo(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),n(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=za.isReactNative()?void 0:{rejectUnauthorized:!yp(e)},o=new mp(e,[],n);wp()?o.onerror=u=>{const c=u;i(this.emitError(c.error))}:o.on("error",u=>{i(this.emitError(u))}),o.onopen=()=>{this.onOpen(o),r(o)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?na(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),o=Bn(e,n);this.events.emit("payload",o)}parseError(e,r=this.url){return op(e,po(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>go&&this.events.setMaxListeners(go)}emitError(e){const r=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${po(this.url)}`));return this.events.emit("register_error",r),r}}var Ei={exports:{}};Ei.exports;(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,o=2,u=9007199254740991,c="[object Arguments]",l="[object Array]",y="[object AsyncFunction]",d="[object Boolean]",I="[object Date]",N="[object Error]",O="[object Function]",x="[object GeneratorFunction]",U="[object Map]",M="[object Number]",H="[object Null]",E="[object Object]",T="[object Promise]",b="[object Proxy]",v="[object RegExp]",f="[object Set]",s="[object String]",h="[object Symbol]",$="[object Undefined]",w="[object WeakMap]",D="[object ArrayBuffer]",S="[object DataView]",L="[object Float32Array]",p="[object Float64Array]",_="[object Int8Array]",z="[object Int16Array]",j="[object Int32Array]",q="[object Uint8Array]",F="[object Uint8ClampedArray]",B="[object Uint16Array]",V="[object Uint32Array]",Q=/[\\^$.*+?()[\]{}|]/g,W=/^\[object .+?Constructor\]$/,ee=/^(?:0|[1-9]\d*)$/,Y={};Y[L]=Y[p]=Y[_]=Y[z]=Y[j]=Y[q]=Y[F]=Y[B]=Y[V]=!0,Y[c]=Y[l]=Y[D]=Y[d]=Y[S]=Y[I]=Y[N]=Y[O]=Y[U]=Y[M]=Y[E]=Y[v]=Y[f]=Y[s]=Y[w]=!1;var te=typeof dt=="object"&&dt&&dt.Object===Object&&dt,R=typeof self=="object"&&self&&self.Object===Object&&self,P=te||R||Function("return this")(),A=e&&!e.nodeType&&e,a=A&&!0&&t&&!t.nodeType&&t,m=a&&a.exports===A,k=m&&te.process,J=function(){try{return k&&k.binding&&k.binding("util")}catch{}}(),he=J&&J.isTypedArray;function be(g,C){for(var K=-1,X=g==null?0:g.length,xe=0,se=[];++K<X;){var Le=g[K];C(Le,K,g)&&(se[xe++]=Le)}return se}function de(g,C){for(var K=-1,X=C.length,xe=g.length;++K<X;)g[xe+K]=C[K];return g}function ve(g,C){for(var K=-1,X=g==null?0:g.length;++K<X;)if(C(g[K],K,g))return!0;return!1}function Fe(g,C){for(var K=-1,X=Array(g);++K<g;)X[K]=C(K);return X}function Ne(g){return function(C){return g(C)}}function ye(g,C){return g.has(C)}function pe(g,C){return g==null?void 0:g[C]}function fe(g){var C=-1,K=Array(g.size);return g.forEach(function(X,xe){K[++C]=[xe,X]}),K}function ue(g,C){return function(K){return g(C(K))}}function ce(g){var C=-1,K=Array(g.size);return g.forEach(function(X){K[++C]=X}),K}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,le=P["__core-js_shared__"],ge=oe.toString,ie=re.hasOwnProperty,_e=function(){var g=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return g?"Symbol(src)_1."+g:""}(),me=re.toString,De=RegExp("^"+ge.call(ie).replace(Q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Se=m?P.Buffer:void 0,Ee=P.Symbol,xt=P.Uint8Array,Rt=re.propertyIsEnumerable,Vt=ae.splice,wt=Ee?Ee.toStringTag:void 0,er=Object.getOwnPropertySymbols,Tr=Se?Se.isBuffer:void 0,ri=ue(Object.keys,Object),Me=br(P,"DataView"),Pe=br(P,"Map"),$e=br(P,"Promise"),je=br(P,"Set"),Be=br(P,"WeakMap"),Re=br(Object,"create"),Ve=rr(Me),He=rr(Pe),We=rr($e),ke=rr(je),Ge=rr(Be),Ke=Ee?Ee.prototype:void 0,qe=Ke?Ke.valueOf:void 0;function Ae(g){var C=-1,K=g==null?0:g.length;for(this.clear();++C<K;){var X=g[C];this.set(X[0],X[1])}}function Ye(){this.__data__=Re?Re(null):{},this.size=0}function Je(g){var C=this.has(g)&&delete this.__data__[g];return this.size-=C?1:0,C}function hc(g){var C=this.__data__;if(Re){var K=C[g];return K===i?void 0:K}return ie.call(C,g)?C[g]:void 0}function fc(g){var C=this.__data__;return Re?C[g]!==void 0:ie.call(C,g)}function dc(g,C){var K=this.__data__;return this.size+=this.has(g)?0:1,K[g]=Re&&C===void 0?i:C,this}Ae.prototype.clear=Ye,Ae.prototype.delete=Je,Ae.prototype.get=hc,Ae.prototype.has=fc,Ae.prototype.set=dc;function jt(g){var C=-1,K=g==null?0:g.length;for(this.clear();++C<K;){var X=g[C];this.set(X[0],X[1])}}function pc(){this.__data__=[],this.size=0}function gc(g){var C=this.__data__,K=ni(C,g);if(K<0)return!1;var X=C.length-1;return K==X?C.pop():Vt.call(C,K,1),--this.size,!0}function yc(g){var C=this.__data__,K=ni(C,g);return K<0?void 0:C[K][1]}function bc(g){return ni(this.__data__,g)>-1}function _c(g,C){var K=this.__data__,X=ni(K,g);return X<0?(++this.size,K.push([g,C])):K[X][1]=C,this}jt.prototype.clear=pc,jt.prototype.delete=gc,jt.prototype.get=yc,jt.prototype.has=bc,jt.prototype.set=_c;function tr(g){var C=-1,K=g==null?0:g.length;for(this.clear();++C<K;){var X=g[C];this.set(X[0],X[1])}}function wc(){this.size=0,this.__data__={hash:new Ae,map:new(Pe||jt),string:new Ae}}function mc(g){var C=si(this,g).delete(g);return this.size-=C?1:0,C}function vc(g){return si(this,g).get(g)}function Ec(g){return si(this,g).has(g)}function Dc(g,C){var K=si(this,g),X=K.size;return K.set(g,C),this.size+=K.size==X?0:1,this}tr.prototype.clear=wc,tr.prototype.delete=mc,tr.prototype.get=vc,tr.prototype.has=Ec,tr.prototype.set=Dc;function ii(g){var C=-1,K=g==null?0:g.length;for(this.__data__=new tr;++C<K;)this.add(g[C])}function Sc(g){return this.__data__.set(g,i),this}function Ic(g){return this.__data__.has(g)}ii.prototype.add=ii.prototype.push=Sc,ii.prototype.has=Ic;function Ht(g){var C=this.__data__=new jt(g);this.size=C.size}function Oc(){this.__data__=new jt,this.size=0}function xc(g){var C=this.__data__,K=C.delete(g);return this.size=C.size,K}function Ac(g){return this.__data__.get(g)}function Cc(g){return this.__data__.has(g)}function Tc(g,C){var K=this.__data__;if(K instanceof jt){var X=K.__data__;if(!Pe||X.length<r-1)return X.push([g,C]),this.size=++K.size,this;K=this.__data__=new tr(X)}return K.set(g,C),this.size=K.size,this}Ht.prototype.clear=Oc,Ht.prototype.delete=xc,Ht.prototype.get=Ac,Ht.prototype.has=Cc,Ht.prototype.set=Tc;function Nc(g,C){var K=oi(g),X=!K&&Wc(g),xe=!K&&!X&&Fi(g),se=!K&&!X&&!xe&&es(g),Le=K||X||xe||se,Xe=Le?Fe(g.length,String):[],rt=Xe.length;for(var Te in g)(C||ie.call(g,Te))&&!(Le&&(Te=="length"||xe&&(Te=="offset"||Te=="parent")||se&&(Te=="buffer"||Te=="byteLength"||Te=="byteOffset")||qc(Te,rt)))&&Xe.push(Te);return Xe}function ni(g,C){for(var K=g.length;K--;)if(Jn(g[K][0],C))return K;return-1}function Pc(g,C,K){var X=C(g);return oi(g)?X:de(X,K(g))}function Nr(g){return g==null?g===void 0?$:H:wt&&wt in Object(g)?jc(g):Hc(g)}function Wn(g){return Pr(g)&&Nr(g)==c}function kn(g,C,K,X,xe){return g===C?!0:g==null||C==null||!Pr(g)&&!Pr(C)?g!==g&&C!==C:Rc(g,C,K,X,kn,xe)}function Rc(g,C,K,X,xe,se){var Le=oi(g),Xe=oi(C),rt=Le?l:Wt(g),Te=Xe?l:Wt(C);rt=rt==c?E:rt,Te=Te==c?E:Te;var mt=rt==E,At=Te==E,st=rt==Te;if(st&&Fi(g)){if(!Fi(C))return!1;Le=!0,mt=!1}if(st&&!mt)return se||(se=new Ht),Le||es(g)?Gn(g,C,K,X,xe,se):Mc(g,C,rt,K,X,xe,se);if(!(K&n)){var Et=mt&&ie.call(g,"__wrapped__"),Dt=At&&ie.call(C,"__wrapped__");if(Et||Dt){var kt=Et?g.value():g,Bt=Dt?C.value():C;return se||(se=new Ht),xe(kt,Bt,K,X,se)}}return st?(se||(se=new Ht),$c(g,C,K,X,xe,se)):!1}function Lc(g){if(!Zn(g)||Kc(g))return!1;var C=Xn(g)?De:W;return C.test(rr(g))}function Uc(g){return Pr(g)&&Qn(g.length)&&!!Y[Nr(g)]}function Fc(g){if(!Vc(g))return ri(g);var C=[];for(var K in Object(g))ie.call(g,K)&&K!="constructor"&&C.push(K);return C}function Gn(g,C,K,X,xe,se){var Le=K&n,Xe=g.length,rt=C.length;if(Xe!=rt&&!(Le&&rt>Xe))return!1;var Te=se.get(g);if(Te&&se.get(C))return Te==C;var mt=-1,At=!0,st=K&o?new ii:void 0;for(se.set(g,C),se.set(C,g);++mt<Xe;){var Et=g[mt],Dt=C[mt];if(X)var kt=Le?X(Dt,Et,mt,C,g,se):X(Et,Dt,mt,g,C,se);if(kt!==void 0){if(kt)continue;At=!1;break}if(st){if(!ve(C,function(Bt,ir){if(!ye(st,ir)&&(Et===Bt||xe(Et,Bt,K,X,se)))return st.push(ir)})){At=!1;break}}else if(!(Et===Dt||xe(Et,Dt,K,X,se))){At=!1;break}}return se.delete(g),se.delete(C),At}function Mc(g,C,K,X,xe,se,Le){switch(K){case S:if(g.byteLength!=C.byteLength||g.byteOffset!=C.byteOffset)return!1;g=g.buffer,C=C.buffer;case D:return!(g.byteLength!=C.byteLength||!se(new xt(g),new xt(C)));case d:case I:case M:return Jn(+g,+C);case N:return g.name==C.name&&g.message==C.message;case v:case s:return g==C+"";case U:var Xe=fe;case f:var rt=X&n;if(Xe||(Xe=ce),g.size!=C.size&&!rt)return!1;var Te=Le.get(g);if(Te)return Te==C;X|=o,Le.set(g,C);var mt=Gn(Xe(g),Xe(C),X,xe,se,Le);return Le.delete(g),mt;case h:if(qe)return qe.call(g)==qe.call(C)}return!1}function $c(g,C,K,X,xe,se){var Le=K&n,Xe=Yn(g),rt=Xe.length,Te=Yn(C),mt=Te.length;if(rt!=mt&&!Le)return!1;for(var At=rt;At--;){var st=Xe[At];if(!(Le?st in C:ie.call(C,st)))return!1}var Et=se.get(g);if(Et&&se.get(C))return Et==C;var Dt=!0;se.set(g,C),se.set(C,g);for(var kt=Le;++At<rt;){st=Xe[At];var Bt=g[st],ir=C[st];if(X)var ts=Le?X(ir,Bt,st,C,g,se):X(Bt,ir,st,g,C,se);if(!(ts===void 0?Bt===ir||xe(Bt,ir,K,X,se):ts)){Dt=!1;break}kt||(kt=st=="constructor")}if(Dt&&!kt){var ai=g.constructor,ci=C.constructor;ai!=ci&&"constructor"in g&&"constructor"in C&&!(typeof ai=="function"&&ai instanceof ai&&typeof ci=="function"&&ci instanceof ci)&&(Dt=!1)}return se.delete(g),se.delete(C),Dt}function Yn(g){return Pc(g,Yc,Bc)}function si(g,C){var K=g.__data__;return zc(C)?K[typeof C=="string"?"string":"hash"]:K.map}function br(g,C){var K=pe(g,C);return Lc(K)?K:void 0}function jc(g){var C=ie.call(g,wt),K=g[wt];try{g[wt]=void 0;var X=!0}catch{}var xe=me.call(g);return X&&(C?g[wt]=K:delete g[wt]),xe}var Bc=er?function(g){return g==null?[]:(g=Object(g),be(er(g),function(C){return Rt.call(g,C)}))}:Jc,Wt=Nr;(Me&&Wt(new Me(new ArrayBuffer(1)))!=S||Pe&&Wt(new Pe)!=U||$e&&Wt($e.resolve())!=T||je&&Wt(new je)!=f||Be&&Wt(new Be)!=w)&&(Wt=function(g){var C=Nr(g),K=C==E?g.constructor:void 0,X=K?rr(K):"";if(X)switch(X){case Ve:return S;case He:return U;case We:return T;case ke:return f;case Ge:return w}return C});function qc(g,C){return C=C??u,!!C&&(typeof g=="number"||ee.test(g))&&g>-1&&g%1==0&&g<C}function zc(g){var C=typeof g;return C=="string"||C=="number"||C=="symbol"||C=="boolean"?g!=="__proto__":g===null}function Kc(g){return!!_e&&_e in g}function Vc(g){var C=g&&g.constructor,K=typeof C=="function"&&C.prototype||re;return g===K}function Hc(g){return me.call(g)}function rr(g){if(g!=null){try{return ge.call(g)}catch{}try{return g+""}catch{}}return""}function Jn(g,C){return g===C||g!==g&&C!==C}var Wc=Wn(function(){return arguments}())?Wn:function(g){return Pr(g)&&ie.call(g,"callee")&&!Rt.call(g,"callee")},oi=Array.isArray;function kc(g){return g!=null&&Qn(g.length)&&!Xn(g)}var Fi=Tr||Xc;function Gc(g,C){return kn(g,C)}function Xn(g){if(!Zn(g))return!1;var C=Nr(g);return C==O||C==x||C==y||C==b}function Qn(g){return typeof g=="number"&&g>-1&&g%1==0&&g<=u}function Zn(g){var C=typeof g;return g!=null&&(C=="object"||C=="function")}function Pr(g){return g!=null&&typeof g=="object"}var es=he?Ne(he):Uc;function Yc(g){return kc(g)?Nc(g):Fc(g)}function Jc(){return[]}function Xc(){return!1}t.exports=Gc})(Ei,Ei.exports);var Ep=Ei.exports;const Dp=qo(Ep);function Sp(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var o=t.charAt(n),u=o.charCodeAt(0);if(r[u]!==255)throw new TypeError(o+" is ambiguous");r[u]=n}var c=t.length,l=t.charAt(0),y=Math.log(c)/Math.log(256),d=Math.log(256)/Math.log(c);function I(x){if(x instanceof Uint8Array||(ArrayBuffer.isView(x)?x=new Uint8Array(x.buffer,x.byteOffset,x.byteLength):Array.isArray(x)&&(x=Uint8Array.from(x))),!(x instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(x.length===0)return"";for(var U=0,M=0,H=0,E=x.length;H!==E&&x[H]===0;)H++,U++;for(var T=(E-H)*d+1>>>0,b=new Uint8Array(T);H!==E;){for(var v=x[H],f=0,s=T-1;(v!==0||f<M)&&s!==-1;s--,f++)v+=256*b[s]>>>0,b[s]=v%c>>>0,v=v/c>>>0;if(v!==0)throw new Error("Non-zero carry");M=f,H++}for(var h=T-M;h!==T&&b[h]===0;)h++;for(var $=l.repeat(U);h<T;++h)$+=t.charAt(b[h]);return $}function N(x){if(typeof x!="string")throw new TypeError("Expected String");if(x.length===0)return new Uint8Array;var U=0;if(x[U]!==" "){for(var M=0,H=0;x[U]===l;)M++,U++;for(var E=(x.length-U)*y+1>>>0,T=new Uint8Array(E);x[U];){var b=r[x.charCodeAt(U)];if(b===255)return;for(var v=0,f=E-1;(b!==0||v<H)&&f!==-1;f--,v++)b+=c*T[f]>>>0,T[f]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");H=v,U++}if(x[U]!==" "){for(var s=E-H;s!==E&&T[s]===0;)s++;for(var h=new Uint8Array(M+(E-s)),$=M;s!==E;)h[$++]=T[s++];return h}}}function O(x){var U=N(x);if(U)return U;throw new Error(`Non-${e} character`)}return{encode:I,decodeUnsafe:N,decode:O}}var Ip=Sp,Op=Ip;const Ha=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},xp=t=>new TextEncoder().encode(t),Ap=t=>new TextDecoder().decode(t);class Cp{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Tp{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Wa(this,e)}}class Np{constructor(e){this.decoders=e}or(e){return Wa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Wa=(t,e)=>new Np({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Pp{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Cp(e,r,i),this.decoder=new Tp(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Li=({name:t,prefix:e,encode:r,decode:i})=>new Pp(t,e,r,i),ti=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Op(r,e);return Li({prefix:t,name:e,encode:i,decode:o=>Ha(n(o))})},Rp=(t,e,r,i)=>{const n={};for(let d=0;d<e.length;++d)n[e[d]]=d;let o=t.length;for(;t[o-1]==="=";)--o;const u=new Uint8Array(o*r/8|0);let c=0,l=0,y=0;for(let d=0;d<o;++d){const I=n[t[d]];if(I===void 0)throw new SyntaxError(`Non-${i} character`);l=l<<r|I,c+=r,c>=8&&(c-=8,u[y++]=255&l>>c)}if(c>=r||255&l<<8-c)throw new SyntaxError("Unexpected end of data");return u},Lp=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let o="",u=0,c=0;for(let l=0;l<t.length;++l)for(c=c<<8|t[l],u+=8;u>r;)u-=r,o+=e[n&c>>u];if(u&&(o+=e[n&c<<r-u]),i)for(;o.length*r&7;)o+="=";return o},nt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>Li({prefix:e,name:t,encode(n){return Lp(n,i,r)},decode(n){return Rp(n,i,r,t)}}),Up=Li({prefix:"\0",name:"identity",encode:t=>Ap(t),decode:t=>xp(t)});var Fp=Object.freeze({__proto__:null,identity:Up});const Mp=nt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var $p=Object.freeze({__proto__:null,base2:Mp});const jp=nt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Bp=Object.freeze({__proto__:null,base8:jp});const qp=ti({prefix:"9",name:"base10",alphabet:"0123456789"});var zp=Object.freeze({__proto__:null,base10:qp});const Kp=nt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Vp=nt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Hp=Object.freeze({__proto__:null,base16:Kp,base16upper:Vp});const Wp=nt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kp=nt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Gp=nt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Yp=nt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Jp=nt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Xp=nt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Qp=nt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Zp=nt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),eg=nt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tg=Object.freeze({__proto__:null,base32:Wp,base32upper:kp,base32pad:Gp,base32padupper:Yp,base32hex:Jp,base32hexupper:Xp,base32hexpad:Qp,base32hexpadupper:Zp,base32z:eg});const rg=ti({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ig=ti({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var ng=Object.freeze({__proto__:null,base36:rg,base36upper:ig});const sg=ti({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),og=ti({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ag=Object.freeze({__proto__:null,base58btc:sg,base58flickr:og});const cg=nt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ug=nt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),lg=nt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hg=nt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var fg=Object.freeze({__proto__:null,base64:cg,base64pad:ug,base64url:lg,base64urlpad:hg});const ka=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),dg=ka.reduce((t,e,r)=>(t[r]=e,t),[]),pg=ka.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function gg(t){return t.reduce((e,r)=>(e+=dg[r],e),"")}function yg(t){const e=[];for(const r of t){const i=pg[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const bg=Li({prefix:"🚀",name:"base256emoji",encode:gg,decode:yg});var _g=Object.freeze({__proto__:null,base256emoji:bg}),wg=Ga,yo=128,mg=127,vg=~mg,Eg=Math.pow(2,31);function Ga(t,e,r){e=e||[],r=r||0;for(var i=r;t>=Eg;)e[r++]=t&255|yo,t/=128;for(;t&vg;)e[r++]=t&255|yo,t>>>=7;return e[r]=t|0,Ga.bytes=r-i+1,e}var Dg=bn,Sg=128,bo=127;function bn(t,i){var r=0,i=i||0,n=0,o=i,u,c=t.length;do{if(o>=c)throw bn.bytes=0,new RangeError("Could not decode varint");u=t[o++],r+=n<28?(u&bo)<<n:(u&bo)*Math.pow(2,n),n+=7}while(u>=Sg);return bn.bytes=o-i,r}var Ig=Math.pow(2,7),Og=Math.pow(2,14),xg=Math.pow(2,21),Ag=Math.pow(2,28),Cg=Math.pow(2,35),Tg=Math.pow(2,42),Ng=Math.pow(2,49),Pg=Math.pow(2,56),Rg=Math.pow(2,63),Lg=function(t){return t<Ig?1:t<Og?2:t<xg?3:t<Ag?4:t<Cg?5:t<Tg?6:t<Ng?7:t<Pg?8:t<Rg?9:10},Ug={encode:wg,decode:Dg,encodingLength:Lg},Ya=Ug;const _o=(t,e,r=0)=>(Ya.encode(t,e,r),e),wo=t=>Ya.encodingLength(t),_n=(t,e)=>{const r=e.byteLength,i=wo(t),n=i+wo(r),o=new Uint8Array(n+r);return _o(t,o,0),_o(r,o,i),o.set(e,n),new Fg(t,r,e,o)};class Fg{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Ja=({name:t,code:e,encode:r})=>new Mg(t,e,r);class Mg{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?_n(this.code,r):r.then(i=>_n(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Xa=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),$g=Ja({name:"sha2-256",code:18,encode:Xa("SHA-256")}),jg=Ja({name:"sha2-512",code:19,encode:Xa("SHA-512")});var Bg=Object.freeze({__proto__:null,sha256:$g,sha512:jg});const Qa=0,qg="identity",Za=Ha,zg=t=>_n(Qa,Za(t)),Kg={code:Qa,name:qg,encode:Za,digest:zg};var Vg=Object.freeze({__proto__:null,identity:Kg});new TextEncoder,new TextDecoder;const mo={...Fp,...$p,...Bp,...zp,...Hp,...tg,...ng,...ag,...fg,..._g};({...Bg,...Vg});function ec(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Hg(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ec(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function tc(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const vo=tc("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Yi=tc("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Hg(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Wg={utf8:vo,"utf-8":vo,hex:mo.base16,latin1:Yi,ascii:Yi,binary:Yi,...mo};function kg(t,e="utf8"){const r=Wg[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ec(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const rc="wc",Gg=2,zn="core",Xt=`${rc}@2:${zn}:`,Yg={name:zn,logger:"error"},Jg={database:":memory:"},Xg="crypto",Eo="client_ed25519_seed",Qg=Z.ONE_DAY,Zg="keychain",e0="0.3",t0="messages",r0="0.3",i0=Z.SIX_HOURS,n0="publisher",ic="irn",s0="error",nc="wss://relay.walletconnect.com",Do="wss://relay.walletconnect.org",o0="relayer",Ue={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},a0="_subscription",qr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},c0=Z.ONE_SECOND/2,u0="2.9.1",l0=1e4,h0="0.3",f0="WALLETCONNECT_CLIENT_ID",$t={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},d0="subscription",p0="0.3",g0=Z.FIVE_SECONDS*1e3,y0="pairing",b0="0.3",zr={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},Mt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},_0="history",w0="0.3",m0="expirer",It={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},v0="0.3",Ji="verify-api",So="https://verify.walletconnect.com";class E0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=Zg,this.version=e0,this.initialized=!1,this.storagePrefix=Xt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:o}=G("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(o)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,La(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ua(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class D0{constructor(e,r,i){this.core=e,this.logger=r,this.name=Xg,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),o=zs(n);return wa(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Wf();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const o=await this.getClientSeed(),u=zs(o),c=gn();return await Zh(c,n,Qg,u)},this.generateSharedKey=(n,o,u)=>{this.isInitialized();const c=this.getPrivateKey(n),l=kf(c,o);return this.setSymKey(l,u)},this.setSymKey=async(n,o)=>{this.isInitialized();const u=o||Gf(n);return await this.keychain.set(u,n),u},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,o,u)=>{this.isInitialized();const c=Pa(u),l=Dn(o);if(Zs(c)){const N=c.senderPublicKey,O=c.receiverPublicKey;n=await this.generateSharedKey(N,O)}const y=this.getSymKey(n),{type:d,senderPublicKey:I}=c;return Jf({type:d,symKey:y,message:l,senderPublicKey:I})},this.decode=async(n,o,u)=>{this.isInitialized();const c=Zf(o,u);if(Zs(c)){const l=c.receiverPublicKey,y=c.senderPublicKey;n=await this.generateSharedKey(l,y)}try{const l=this.getSymKey(n),y=Xf({symKey:l,encoded:o});return na(y)}catch(l){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(l)}},this.getPayloadType=n=>{const o=wi(n);return Zr(o.type)},this.getPayloadSenderPublicKey=n=>{const o=wi(n);return o.senderPublicKey?yt(o.senderPublicKey,gt):void 0},this.core=e,this.logger=we.generateChildLogger(r,this.name),this.keychain=i||new E0(this.core,this.logger)}get context(){return we.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Eo)}catch{e=gn(),await this.keychain.set(Eo,e)}return kg(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class S0 extends rl{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=t0,this.version=r0,this.initialized=!1,this.storagePrefix=Xt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const o=Sr(n);let u=this.messages.get(i);return typeof u>"u"&&(u={}),typeof u[o]<"u"||(u[o]=n,this.messages.set(i,u),await this.persist()),o},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const o=this.get(i),u=Sr(n);return typeof o[u]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=we.generateChildLogger(e,this.name),this.core=r}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,La(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ua(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class I0 extends il{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new Pt.EventEmitter,this.name=n0,this.queue=new Map,this.publishTimeout=Z.toMiliseconds(Z.TEN_SECONDS),this.queueTimeout=Z.toMiliseconds(Z.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(i,n,o)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:o}});try{const u=(o==null?void 0:o.ttl)||i0,c=yn(o),l=(o==null?void 0:o.prompt)||!1,y=(o==null?void 0:o.tag)||0,d=(o==null?void 0:o.id)||$n().toString(),I={topic:i,message:n,opts:{ttl:u,relay:c,prompt:l,tag:y,id:d}},N=setTimeout(()=>this.queue.set(d,I),this.queueTimeout);try{await await mi(this.rpcPublish(i,n,u,c,l,y,d),this.publishTimeout),clearTimeout(N),this.relayer.events.emit(Ue.publish,I)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:o}})}catch(u){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(u),u}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=we.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return we.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,o,u,c){var l,y,d,I;const N={method:pi(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:o,tag:u},id:c};return pt((l=N.params)==null?void 0:l.prompt)&&((y=N.params)==null||delete y.prompt),pt((d=N.params)==null?void 0:d.tag)&&((I=N.params)==null||delete I.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:N}),this.relayer.request(N)}onPublish(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(Or.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Ue.connection_stalled);return}this.checkQueue()}),this.relayer.on(Ue.message_ack,e=>{this.onPublish(e.id.toString())})}}class O0{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(o=>o!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var x0=Object.defineProperty,A0=Object.defineProperties,C0=Object.getOwnPropertyDescriptors,Io=Object.getOwnPropertySymbols,T0=Object.prototype.hasOwnProperty,N0=Object.prototype.propertyIsEnumerable,Oo=(t,e,r)=>e in t?x0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Kr=(t,e)=>{for(var r in e||(e={}))T0.call(e,r)&&Oo(t,r,e[r]);if(Io)for(var r of Io(e))N0.call(e,r)&&Oo(t,r,e[r]);return t},Xi=(t,e)=>A0(t,C0(e));class P0 extends ol{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new O0,this.events=new Pt.EventEmitter,this.name=d0,this.version=p0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Xt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const o=yn(n),u={topic:i,relay:o};this.pending.set(i,u);const c=await this.rpcSubscribe(i,o);return this.onSubscribe(c,u),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}}),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof(n==null?void 0:n.id)<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>this.topics.includes(i)?!0:await new Promise((n,o)=>{const u=new Z.Watch;u.start(this.pendingSubscriptionWatchLabel);const c=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),n(!0)),u.elapsed(this.pendingSubscriptionWatchLabel)>=g0&&(clearInterval(c),u.stop(this.pendingSubscriptionWatchLabel),o(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=we.generateChildLogger(r,this.name),this.clientId=""}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=yn(i);await this.rpcUnsubscribe(e,r,n);const o=et("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:pi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await mi(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Ue.connection_stalled)}return Sr(e+this.clientId)}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:pi(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await mi(this.relayer.request(i),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Ue.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:pi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Xi(Kr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Kr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.subscriptions.has(e)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r))}addSubscription(e,r){this.subscriptions.set(e,Kr({},r)),this.topicMap.set(r.topic,e),this.events.emit($t.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit($t.deleted,Xi(Kr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit($t.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit($t.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);ei(r)&&this.onBatchSubscribe(r.map((i,n)=>Xi(Kr({},e[n]),{id:i})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(Or.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Ue.connect,async()=>{await this.onConnect()}),this.relayer.on(Ue.disconnect,()=>{this.onDisconnect()}),this.events.on($t.created,async e=>{const r=$t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on($t.deleted,async e=>{const r=$t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var R0=Object.defineProperty,xo=Object.getOwnPropertySymbols,L0=Object.prototype.hasOwnProperty,U0=Object.prototype.propertyIsEnumerable,Ao=(t,e,r)=>e in t?R0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,F0=(t,e)=>{for(var r in e||(e={}))L0.call(e,r)&&Ao(t,r,e[r]);if(xo)for(var r of xo(e))U0.call(e,r)&&Ao(t,r,e[r]);return t};class M0 extends nl{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new Pt.EventEmitter,this.name=o0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(i){throw this.logger.debug("Failed to Publish Request"),this.logger.error(i),i}},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?we.generateChildLogger(e.logger,this.name):we.pino(we.getDefaultLoggerOptions({level:e.logger||s0})),this.messages=new S0(this.logger,e.core),this.subscriber=new P0(this,this.logger),this.publisher=new I0(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||nc,this.projectId=e.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Do}...`),await this.restartTransport(Do)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},l0)}get context(){return we.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"";return n||(await Promise.all([new Promise(o=>{this.subscriber.once($t.created,u=>{u.topic===e&&o()})}),new Promise(async o=>{n=await this.subscriber.subscribe(e,r),o()})]),n)}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(Ue.transport_closed))}async transportOpen(e){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=e||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(r=>{this.initialized||r(),this.subscriber.once($t.resubscribed,()=>{r()})}),await Promise.race([new Promise(async(r,i)=>{await mi(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(n=>i(n)).then(()=>r()).finally(()=>this.removeListener(Ue.transport_closed,this.rejectTransportOpen))}),new Promise(r=>this.once(Ue.transport_closed,this.rejectTransportOpen))])])}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r;this.events.emit(Ue.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(e){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=e||this.relayUrl,this.connected&&await Promise.all([new Promise(r=>{this.provider.once(qr.disconnect,()=>{r()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new bp(new vp(ld({sdkVersion:u0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),qn(e)){if(!e.method.endsWith(a0))return;const r=e.params,{topic:i,message:n,publishedAt:o}=r.data,u={topic:i,message:n,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(F0({type:"event",event:r.id},u)),this.events.emit(r.id,u),await this.acknowledgePayload(e),await this.onMessageEvent(u)}else Ri(e)&&this.events.emit(Ue.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Ue.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=jn(e.id,!0);await this.provider.connection.send(r)}registerProviderListeners(){this.provider.on(qr.payload,e=>this.onProviderPayload(e)),this.provider.on(qr.connect,()=>{this.events.emit(Ue.connect)}),this.provider.on(qr.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(qr.error,e=>{this.logger.error(e),this.events.emit(Ue.error,e)})}registerEventListeners(){this.events.on(Ue.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(Ue.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},Z.toMiliseconds(c0))}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var $0=Object.defineProperty,Co=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,B0=Object.prototype.propertyIsEnumerable,To=(t,e,r)=>e in t?$0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,No=(t,e)=>{for(var r in e||(e={}))j0.call(e,r)&&To(t,r,e[r]);if(Co)for(var r of Co(e))B0.call(e,r)&&To(t,r,e[r]);return t};class Ui extends sl{constructor(e,r,i,n=Xt,o=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=h0,this.cached=[],this.initialized=!1,this.storagePrefix=Xt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(u=>{this.getKey&&u!==null&&!pt(u)?this.map.set(this.getKey(u),u):Rd(u)?this.map.set(u.id,u):Ld(u)&&this.map.set(u.topic,u)}),this.cached=[],this.initialized=!0)},this.set=async(u,c)=>{this.isInitialized(),this.map.has(u)?await this.update(u,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:u,value:c}),this.map.set(u,c),await this.persist())},this.get=u=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:u}),this.getData(u)),this.getAll=u=>(this.isInitialized(),u?this.values.filter(c=>Object.keys(u).every(l=>Dp(c[l],u[l]))):this.values),this.update=async(u,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:u,update:c});const l=No(No({},this.getData(u)),c);this.map.set(u,l),await this.persist()},this.delete=async(u,c)=>{this.isInitialized(),this.map.has(u)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:u,reason:c}),this.map.delete(u),await this.persist())},this.logger=we.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=o}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class q0{constructor(e,r){this.core=e,this.logger=r,this.name=y0,this.version=b0,this.events=new Xo,this.initialized=!1,this.storagePrefix=Xt,this.ignoredPayloadTypes=[yr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=gn(),n=await this.core.crypto.setSymKey(i),o=Ct(Z.FIVE_MINUTES),u={protocol:ic},c={topic:n,expiry:o,relay:u,active:!1},l=Dd({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:u});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,o),{topic:n,uri:l}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:o,relay:u}=md(i.uri);if(this.pairings.keys.includes(n))throw new Error(`Pairing already exists: ${n}`);if(this.core.crypto.hasKeys(n))throw new Error(`Keychain already exists: ${n}`);const c=Ct(Z.FIVE_MINUTES),l={topic:n,relay:u,expiry:c,active:!1};return await this.pairings.set(n,l),await this.core.crypto.setSymKey(o,n),await this.core.relayer.subscribe(n,{relay:u}),this.core.expirer.set(n,c),i.activatePairing&&await this.activate({topic:n}),l},this.activate=async({topic:i})=>{this.isInitialized();const n=Ct(Z.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const o=await this.sendRequest(n,"wc_pairingPing",{}),{done:u,resolve:c,reject:l}=vr();this.events.once(ze("pairing_ping",o),({error:y})=>{y?l(y):c()}),await u()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",et("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,o)=>{const u=Pi(n,o),c=await this.core.crypto.encode(i,u),l=zr[n].req;return this.core.history.set(i,u),this.core.relayer.publish(i,c,l),u.id},this.sendResult=async(i,n,o)=>{const u=jn(i,o),c=await this.core.crypto.encode(n,u),l=await this.core.history.get(n,i),y=zr[l.request.method].res;await this.core.relayer.publish(n,c,y),await this.core.history.resolve(u)},this.sendError=async(i,n,o)=>{const u=Bn(i,o),c=await this.core.crypto.encode(n,u),l=await this.core.history.get(n,i),y=zr[l.request.method]?zr[l.request.method].res:zr.unregistered_method.res;await this.core.relayer.publish(n,c,y),await this.core.history.resolve(u)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,et("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Yt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:o}=i;switch(o.method){case"wc_pairingPing":return this.onPairingPingRequest(n,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,o);default:return this.onUnknownRpcMethodRequest(n,o)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:o}=i,u=(await this.core.history.get(n,o.id)).request.method;switch(u){case"wc_pairingPing":return this.onPairingPingResponse(n,o);default:return this.onUnknownRpcMethodResponse(u)}},this.onPairingPingRequest=async(i,n)=>{const{id:o}=n;try{this.isValidPing({topic:i}),await this.sendResult(o,i,!0),this.events.emit("pairing_ping",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onPairingPingResponse=(i,n)=>{const{id:o}=n;setTimeout(()=>{Kt(n)?this.events.emit(ze("pairing_ping",o),{}):Tt(n)&&this.events.emit(ze("pairing_ping",o),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:o}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit("pairing_delete",{id:o,topic:i})}catch(u){await this.sendError(o,i,u),this.logger.error(u)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:o,method:u}=n;try{if(this.registeredMethods.includes(u))return;const c=et("WC_METHOD_UNSUPPORTED",u);await this.sendError(o,i,c),this.logger.error(c)}catch(c){await this.sendError(o,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(et("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{if(!bt(i)){const{message:n}=G("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(n)}if(!Pd(i.uri)){const{message:n}=G("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(n)}},this.isValidPing=async i=>{if(!bt(i)){const{message:o}=G("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!bt(i)){const{message:o}=G("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(o)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!tt(i,!1)){const{message:n}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Yt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=G("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=we.generateChildLogger(r,this.name),this.pairings=new Ui(this.core,this.logger,this.name,this.storagePrefix)}get context(){return we.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Ue.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);qn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ri(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))})}registerExpirerEvents(){this.core.expirer.on(It.expired,async e=>{const{topic:r}=Ma(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class z0 extends tl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new Pt.EventEmitter,this.name=_0,this.version=w0,this.cached=[],this.initialized=!1,this.storagePrefix=Xt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:o}),this.records.has(n.id))return;const u={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:o,expiry:Ct(Z.THIRTY_DAYS)};this.records.set(u.id,u),this.events.emit(Mt.created,u)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Tt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Mt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(o=>{if(o.topic===i){if(typeof n<"u"&&o.id!==n)return;this.records.delete(o.id),this.events.emit(Mt.deleted,o)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:Pi(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Mt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Mt.created,e=>{const r=Mt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Mt.updated,e=>{const r=Mt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Mt.deleted,e=>{const r=Mt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(Or.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Z.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class K0 extends al{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new Pt.EventEmitter,this.name=m0,this.version=v0,this.cached=[],this.initialized=!1,this.storagePrefix=Xt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const o=this.formatTarget(i),u={target:o,expiry:n};this.expirations.set(o,u),this.checkExpiry(o,u),this.events.emit(It.created,{target:o,expiration:u})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),o=this.getExpiration(n);this.expirations.delete(n),this.events.emit(It.deleted,{target:n,expiration:o})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=we.generateChildLogger(r,this.name)}get context(){return we.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return hd(e);if(typeof e=="number")return fd(e);const{message:r}=G("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(It.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=G("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=G("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(It.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(Or.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(It.created,e=>{const r=It.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(It.expired,e=>{const r=It.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(It.deleted,e=>{const r=It.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}}class V0 extends cl{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=Ji,this.initialized=!1,this.init=async i=>{Ra()||!Ln()||(this.verifyUrl=(i==null?void 0:i.verifyUrl)||So,await this.createIframe())},this.register=async i=>{var n;if(this.initialized||await this.init(),!!this.iframe)try{(n=this.iframe.contentWindow)==null||n.postMessage(i.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${i.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async i=>{var n;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${i.attestationId}`);const o=this.startAbortTimer(Z.FIVE_SECONDS),u=await fetch(`${this.verifyUrl}/attestation/${i.attestationId}`,{signal:this.abortController.signal});return clearTimeout(o),u.status===200?(n=await u.json())==null?void 0:n.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((i,n)=>{if(document.getElementById(Ji))return i();const o=document.createElement("iframe");o.setAttribute("id",Ji),o.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),o.style.display="none",o.addEventListener("load",()=>{this.initialized=!0,i()}),o.addEventListener("error",u=>{n(u)}),document.body.append(o),this.iframe=o}),new Promise(i=>{setTimeout(()=>i("iframe load timeout"),Z.toMiliseconds(Z.ONE_SECOND/2))})])}catch(i){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(i)}},this.logger=we.generateChildLogger(r,this.name),this.verifyUrl=So,this.abortController=new AbortController,this.isDevEnv=Rn()&&{}.IS_VITEST}get context(){return we.getLoggerContext(this.logger)}startAbortTimer(e){return setTimeout(()=>this.abortController.abort(),Z.toMiliseconds(e))}}var H0=Object.defineProperty,Po=Object.getOwnPropertySymbols,W0=Object.prototype.hasOwnProperty,k0=Object.prototype.propertyIsEnumerable,Ro=(t,e,r)=>e in t?H0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Lo=(t,e)=>{for(var r in e||(e={}))W0.call(e,r)&&Ro(t,r,e[r]);if(Po)for(var r of Po(e))k0.call(e,r)&&Ro(t,r,e[r]);return t};class Kn extends el{constructor(e){super(e),this.protocol=rc,this.version=Gg,this.name=zn,this.events=new Pt.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||nc;const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:we.pino(we.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Yg.logger}));this.logger=we.generateChildLogger(r,this.name),this.heartbeat=new Or.HeartBeat,this.crypto=new D0(this,this.logger,e==null?void 0:e.keychain),this.history=new z0(this,this.logger),this.expirer=new K0(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new Mu(Lo(Lo({},Jg),e==null?void 0:e.storageOptions)),this.relayer=new M0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new q0(this,this.logger),this.verify=new V0(this.projectId||"",this.logger)}static async init(e){const r=new Kn(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(f0,i),r}get context(){return we.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const G0=Kn,sc="wc",oc=2,ac="client",Vn=`${sc}@${oc}:${ac}:`,Qi={name:ac,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Y0="WALLETCONNECT_DEEPLINK_CHOICE",J0="proposal",X0="Proposal expired",Q0="session",fi=Z.SEVEN_DAYS,Z0="engine",Vr={wc_sessionPropose:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1104},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1106},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:Z.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:Z.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1112},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1115}}},Zi={min:Z.FIVE_MINUTES,max:Z.SEVEN_DAYS},Hr={idle:"idle",active:"active"},ey="request",ty=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var ry=Object.defineProperty,iy=Object.defineProperties,ny=Object.getOwnPropertyDescriptors,Uo=Object.getOwnPropertySymbols,sy=Object.prototype.hasOwnProperty,oy=Object.prototype.propertyIsEnumerable,Fo=(t,e,r)=>e in t?ry(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,St=(t,e)=>{for(var r in e||(e={}))sy.call(e,r)&&Fo(t,r,e[r]);if(Uo)for(var r of Uo(e))oy.call(e,r)&&Fo(t,r,e[r]);return t},en=(t,e)=>iy(t,ny(e));class ay extends ll{constructor(e){super(e),this.name=Z0,this.events=new Xo,this.initialized=!1,this.ignoredPayloadTypes=[yr],this.requestQueue={state:Hr.idle,requests:[]},this.requestQueueDelay=Z.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Vr)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},Z.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{this.isInitialized();const i=en(St({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:o,optionalNamespaces:u,sessionProperties:c,relays:l}=i;let y=n,d,I=!1;if(y&&(I=this.client.core.pairing.pairings.get(y).active),!y||!I){const{topic:T,uri:b}=await this.client.core.pairing.create();y=T,d=b}const N=await this.client.core.crypto.generateKeyPair(),O=St({requiredNamespaces:o,optionalNamespaces:u,relays:l??[{protocol:ic}],proposer:{publicKey:N,metadata:this.client.metadata}},c&&{sessionProperties:c}),{reject:x,resolve:U,done:M}=vr(Z.FIVE_MINUTES,X0);if(this.events.once(ze("session_connect"),async({error:T,session:b})=>{if(T)x(T);else if(b){b.self.publicKey=N;const v=en(St({},b),{requiredNamespaces:b.requiredNamespaces,optionalNamespaces:b.optionalNamespaces});await this.client.session.set(b.topic,v),await this.setExpiry(b.topic,b.expiry),y&&await this.client.core.pairing.updateMetadata({topic:y,metadata:b.peer.metadata}),U(v)}}),!y){const{message:T}=G("NO_MATCHING_KEY",`connect() pairing topic: ${y}`);throw new Error(T)}const H=await this.sendRequest(y,"wc_sessionPropose",O),E=Ct(Z.FIVE_MINUTES);return await this.setProposal(H,St({id:H,expiry:E},O)),{uri:d,approval:M}},this.pair=async r=>(this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{this.isInitialized(),await this.isValidApprove(r);const{id:i,relayProtocol:n,namespaces:o,sessionProperties:u}=r,c=this.client.proposal.get(i);let{pairingTopic:l,proposer:y,requiredNamespaces:d,optionalNamespaces:I}=c;l=l||"",kr(d)||(d=xd(o,"approve()"));const N=await this.client.core.crypto.generateKeyPair(),O=y.publicKey,x=await this.client.core.crypto.generateSharedKey(N,O);l&&i&&(await this.client.core.pairing.updateMetadata({topic:l,metadata:y.metadata}),await this.sendResult(i,l,{relay:{protocol:n??"irn"},responderPublicKey:N}),await this.client.proposal.delete(i,et("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:l}));const U=St({relay:{protocol:n??"irn"},namespaces:o,requiredNamespaces:d,optionalNamespaces:I,pairingTopic:l,controller:{publicKey:N,metadata:this.client.metadata},expiry:Ct(fi)},u&&{sessionProperties:u});await this.client.core.relayer.subscribe(x),await this.sendRequest(x,"wc_sessionSettle",U);const M=en(St({},U),{topic:x,pairingTopic:l,acknowledged:!1,self:U.controller,peer:{publicKey:y.publicKey,metadata:y.metadata},controller:N});return await this.client.session.set(x,M),await this.setExpiry(x,Ct(fi)),{topic:x,acknowledged:()=>new Promise(H=>setTimeout(()=>H(this.client.session.get(x)),500))}},this.reject=async r=>{this.isInitialized(),await this.isValidReject(r);const{id:i,reason:n}=r,{pairingTopic:o}=this.client.proposal.get(i);o&&(await this.sendError(i,o,n),await this.client.proposal.delete(i,et("USER_DISCONNECTED")))},this.update=async r=>{this.isInitialized(),await this.isValidUpdate(r);const{topic:i,namespaces:n}=r,o=await this.sendRequest(i,"wc_sessionUpdate",{namespaces:n}),{done:u,resolve:c,reject:l}=vr();return this.events.once(ze("session_update",o),({error:y})=>{y?l(y):c()}),await this.client.session.update(i,{namespaces:n}),{acknowledged:u}},this.extend=async r=>{this.isInitialized(),await this.isValidExtend(r);const{topic:i}=r,n=await this.sendRequest(i,"wc_sessionExtend",{}),{done:o,resolve:u,reject:c}=vr();return this.events.once(ze("session_extend",n),({error:l})=>{l?c(l):u()}),await this.setExpiry(i,Ct(fi)),{acknowledged:o}},this.request=async r=>{this.isInitialized(),await this.isValidRequest(r);const{chainId:i,request:n,topic:o,expiry:u}=r,c=await this.sendRequest(o,"wc_sessionRequest",{request:n,chainId:i},u),{done:l,resolve:y,reject:d}=vr(u);this.events.once(ze("session_request",c),({error:N,result:O})=>{N?d(N):y(O)}),this.client.events.emit("session_request_sent",{topic:o,request:n,chainId:i,id:c});const I=await this.client.core.storage.getItem(Y0);return dd({id:c,topic:o,wcDeepLink:I}),await l()},this.respond=async r=>{this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:o}=n;Kt(n)?await this.sendResult(o,i,n.result):Tt(n)&&await this.sendError(o,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=await this.sendRequest(i,"wc_sessionPing",{}),{done:o,resolve:u,reject:c}=vr();this.events.once(ze("session_ping",n),({error:l})=>{l?c(l):u()}),await o()}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:o}=r;await this.sendRequest(i,"wc_sessionEvent",{event:n,chainId:o})},this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=$n().toString();let o;const u=c=>{(c==null?void 0:c.id.toString())===n&&(this.client.core.relayer.events.removeListener(Ue.message_ack,u),o())};await Promise.all([new Promise(c=>{o=c,this.client.core.relayer.on(Ue.message_ack,u)}),this.sendRequest(i,"wc_sessionDelete",et("USER_DISCONNECTED"),void 0,n)]),await this.deleteSession(i)}else await this.client.core.pairing.disconnect({topic:i})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>Td(i,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(o=>{var u,c;return((u=o.peerMetadata)==null?void 0:u.url)&&((c=o.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&o.topic&&o.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(o=>this.client.core.pairing.disconnect({topic:o.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async(r,i)=>{const{self:n}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,et("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(n.publicKey)&&await this.client.core.crypto.deleteKeyPair(n.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),i||this.client.core.expirer.del(r)},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,et("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.requestQueue.requests=this.requestQueue.requests.filter(o=>o.id!==r),n&&(this.requestQueue.state=Hr.idle)},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,i.expiry)},this.setPendingSessionRequest=async r=>{const i=Vr.wc_sessionRequest.req.ttl,{id:n,topic:o,params:u}=r;await this.client.pendingRequest.set(n,{id:n,topic:o,params:u}),i&&this.client.core.expirer.set(n,Ct(i))},this.sendRequest=async(r,i,n,o,u)=>{const c=Pi(i,n);if(Ln()&&ty.includes(i)){const d=Sr(JSON.stringify(c));await this.client.core.verify.register({attestationId:d})}const l=await this.client.core.crypto.encode(r,c),y=Vr[i].req;return o&&(y.ttl=o),u&&(y.id=u),this.client.core.history.set(r,c),this.client.core.relayer.publish(r,l,y),c.id},this.sendResult=async(r,i,n)=>{const o=jn(r,n),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),l=Vr[c.request.method].res;this.client.core.relayer.publish(i,u,l),await this.client.core.history.resolve(o)},this.sendError=async(r,i,n)=>{const o=Bn(r,n),u=await this.client.core.crypto.encode(i,o),c=await this.client.core.history.get(i,r),l=Vr[c.request.method].res;this.client.core.relayer.publish(i,u,l),await this.client.core.history.resolve(o)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{Yt(n.expiry)&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Yt(n.expiry)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession(n)),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=r=>{const{topic:i,payload:n}=r,o=n.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${o}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=G("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:o}=i;try{this.isValidConnect(St({},i.params));const u=Ct(Z.FIVE_MINUTES),c=St({id:o,pairingTopic:r,expiry:u},n);await this.setProposal(o,c);const l=Sr(JSON.stringify(i)),y=await this.getVerifyContext(l,c.proposer.metadata);this.client.events.emit("session_proposal",{id:o,params:c,verifyContext:y})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Kt(i)){const{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const u=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:u});const c=u.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const y=await this.client.core.crypto.generateSharedKey(c,l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:y});const d=await this.client.core.relayer.subscribe(y);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:d}),await this.client.core.pairing.activate({topic:r})}else Tt(i)&&(await this.client.proposal.delete(n,et("USER_DISCONNECTED")),this.events.emit(ze("session_connect"),{error:i.error}))},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:o}=i;try{this.isValidSessionSettleRequest(o);const{relay:u,controller:c,expiry:l,namespaces:y,requiredNamespaces:d,optionalNamespaces:I,sessionProperties:N,pairingTopic:O}=i.params,x=St({topic:r,relay:u,expiry:l,namespaces:y,acknowledged:!0,pairingTopic:O,requiredNamespaces:d,optionalNamespaces:I,controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},N&&{sessionProperties:N});await this.sendResult(i.id,r,!0),this.events.emit(ze("session_connect"),{session:x}),this.cleanupDuplicatePairings(x)}catch(u){await this.sendError(n,r,u),this.client.logger.error(u)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Kt(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(ze("session_approve",n),{})):Tt(i)&&(await this.client.session.delete(r,et("USER_DISCONNECTED")),this.events.emit(ze("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:o}=i;try{this.isValidUpdate(St({topic:r},n)),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult(o,r,!0),this.client.events.emit("session_update",{id:o,topic:r,params:n})}catch(u){await this.sendError(o,r,u),this.client.logger.error(u)}},this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i;Kt(i)?this.events.emit(ze("session_update",n),{}):Tt(i)&&this.events.emit(ze("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Ct(fi)),await this.sendResult(n,r,!0),this.client.events.emit("session_extend",{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i;Kt(i)?this.events.emit(ze("session_extend",n),{}):Tt(i)&&this.events.emit(ze("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult(n,r,!0),this.client.events.emit("session_ping",{id:n,topic:r})}catch(o){await this.sendError(n,r,o),this.client.logger.error(o)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i;setTimeout(()=>{Kt(i)?this.events.emit(ze("session_ping",n),{}):Tt(i)&&this.events.emit(ze("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(o=>{this.client.core.relayer.once(Ue.publish,async()=>{o(await this.deleteSession(r))})}),this.sendResult(n,r,!0)]),this.client.events.emit("session_delete",{id:n,topic:r})}catch(o){this.client.logger.error(o)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:o}=i;try{this.isValidRequest(St({topic:r},o)),await this.setPendingSessionRequest({id:n,topic:r,params:o}),this.addRequestToQueue({id:n,topic:r,params:o}),await this.processRequestQueue()}catch(u){await this.sendError(n,r,u),this.client.logger.error(u)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i;Kt(i)?this.events.emit(ze("session_request",n),{result:i.result}):Tt(i)&&this.events.emit(ze("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:o}=i;try{this.isValidEmit(St({topic:r},o)),this.client.events.emit("session_event",{id:n,topic:r,params:o})}catch(u){await this.sendError(n,r,u),this.client.logger.error(u)}},this.addRequestToQueue=r=>{this.requestQueue.requests.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=Hr.idle,this.processRequestQueue()},Z.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===Hr.active){this.client.logger.info("session request queue is already active.");return}const r=this.requestQueue.requests[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:i,topic:n,params:o}=r,u=Sr(JSON.stringify({id:i,params:o})),c=this.client.session.get(n),l=await this.getVerifyContext(u,c.peer.metadata);this.requestQueue.state=Hr.active,this.client.events.emit("session_request",{id:i,topic:n,params:o,verifyContext:l})}catch(i){this.client.logger.error(i)}},this.isValidConnect=async r=>{if(!bt(r)){const{message:l}=G("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(l)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:o,sessionProperties:u,relays:c}=r;if(pt(i)||await this.isValidPairingTopic(i),!zd(c,!0)){const{message:l}=G("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}!pt(n)&&kr(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!pt(o)&&kr(o)!==0&&this.validateNamespaces(o,"optionalNamespaces"),pt(u)||this.validateSessionProps(u,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=qd(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!bt(r))throw new Error(G("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:o,sessionProperties:u}=r;await this.isValidProposalId(i);const c=this.client.proposal.get(i),l=gi(n,"approve()");if(l)throw new Error(l.message);const y=ao(c.requiredNamespaces,n,"approve()");if(y)throw new Error(y.message);if(!tt(o,!0)){const{message:d}=G("MISSING_OR_INVALID",`approve() relayProtocol: ${o}`);throw new Error(d)}pt(u)||this.validateSessionProps(u,"sessionProperties")},this.isValidReject=async r=>{if(!bt(r)){const{message:o}=G("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(o)}const{id:i,reason:n}=r;if(await this.isValidProposalId(i),!Vd(n)){const{message:o}=G("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(o)}},this.isValidSessionSettleRequest=r=>{if(!bt(r)){const{message:y}=G("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(y)}const{relay:i,controller:n,namespaces:o,expiry:u}=r;if(!ja(i)){const{message:y}=G("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(y)}const c=Ud(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const l=gi(o,"onSessionSettleRequest()");if(l)throw new Error(l.message);if(Yt(u)){const{message:y}=G("EXPIRED","onSessionSettleRequest()");throw new Error(y)}},this.isValidUpdate=async r=>{if(!bt(r)){const{message:l}=G("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(l)}const{topic:i,namespaces:n}=r;await this.isValidSessionTopic(i);const o=this.client.session.get(i),u=gi(n,"update()");if(u)throw new Error(u.message);const c=ao(o.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!bt(r)){const{message:n}=G("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!bt(r)){const{message:l}=G("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(l)}const{topic:i,request:n,chainId:o,expiry:u}=r;await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!oo(c,o)){const{message:l}=G("MISSING_OR_INVALID",`request() chainId: ${o}`);throw new Error(l)}if(!Hd(n)){const{message:l}=G("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(l)}if(!Gd(c,o,n.method)){const{message:l}=G("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(l)}if(u&&!Qd(u,Zi)){const{message:l}=G("MISSING_OR_INVALID",`request() expiry: ${u}. Expiry must be a number (in seconds) between ${Zi.min} and ${Zi.max}`);throw new Error(l)}},this.isValidRespond=async r=>{if(!bt(r)){const{message:o}=G("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(o)}const{topic:i,response:n}=r;if(await this.isValidSessionTopic(i),!Wd(n)){const{message:o}=G("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(n)}`);throw new Error(o)}},this.isValidPing=async r=>{if(!bt(r)){const{message:n}=G("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!bt(r)){const{message:c}=G("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:o}=r;await this.isValidSessionTopic(i);const{namespaces:u}=this.client.session.get(i);if(!oo(u,o)){const{message:c}=G("MISSING_OR_INVALID",`emit() chainId: ${o}`);throw new Error(c)}if(!kd(n)){const{message:c}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!Yd(u,o,n.name)){const{message:c}=G("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!bt(r)){const{message:n}=G("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||"",validation:"UNKNOWN",origin:i.url||""}};try{const o=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});o&&(n.verified.origin=o,n.verified.validation=o===i.url?"VALID":"INVALID")}catch(o){this.client.logger.error(o)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!tt(n,!1)){const{message:o}=G("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(o)}})}}isInitialized(){if(!this.initialized){const{message:e}=G("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.client.core.relayer.on(Ue.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);qn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):Ri(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})})}registerExpirerEvents(){this.client.core.expirer.on(It.expired,async e=>{const{topic:r,id:i}=Ma(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,G("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}isValidPairingTopic(e){if(!tt(e,!1)){const{message:r}=G("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Yt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=G("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!tt(e,!1)){const{message:r}=G("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(!this.client.session.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Yt(this.client.session.get(e).expiry)){await this.deleteSession(e);const{message:r}=G("EXPIRED",`session topic: ${e}`);throw new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(tt(e,!1)){const{message:r}=G("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=G("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Kd(e)){const{message:r}=G("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=G("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Yt(this.client.proposal.get(e).expiry)){await this.deleteProposal(e);const{message:r}=G("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class cy extends Ui{constructor(e,r){super(e,r,J0,Vn),this.core=e,this.logger=r}}class uy extends Ui{constructor(e,r){super(e,r,Q0,Vn),this.core=e,this.logger=r}}class ly extends Ui{constructor(e,r){super(e,r,ey,Vn,i=>i.id),this.core=e,this.logger=r}}let hy=class cc extends ul{constructor(e){super(e),this.protocol=sc,this.version=oc,this.name=Qi.name,this.events=new Pt.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=(e==null?void 0:e.name)||Qi.name,this.metadata=(e==null?void 0:e.metadata)||od();const r=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:we.pino(we.getDefaultLoggerOptions({level:(e==null?void 0:e.logger)||Qi.logger}));this.core=(e==null?void 0:e.core)||new G0(e),this.logger=we.generateChildLogger(r,this.name),this.session=new uy(this.core,this.logger),this.proposal=new cy(this.core,this.logger),this.pendingRequest=new ly(this.core,this.logger),this.engine=new ay(this)}static async init(e){const r=new cc(e);return await r.initialize(),r}get context(){return we.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var fy=Object.defineProperty,dy=Object.defineProperties,py=Object.getOwnPropertyDescriptors,Mo=Object.getOwnPropertySymbols,gy=Object.prototype.hasOwnProperty,yy=Object.prototype.propertyIsEnumerable,$o=(t,e,r)=>e in t?fy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,by=(t,e)=>{for(var r in e||(e={}))gy.call(e,r)&&$o(t,r,e[r]);if(Mo)for(var r of Mo(e))yy.call(e,r)&&$o(t,r,e[r]);return t},_y=(t,e)=>dy(t,py(e)),Hn=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)},Ce=(t,e,r)=>(Hn(t,e,"read from private field"),r?r.call(t):e.get(t)),lr=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},Di=(t,e,r,i)=>(Hn(t,e,"write to private field"),i?i.call(t,r):e.set(t,r),r),ct=(t,e,r)=>(Hn(t,e,"access private method"),r),hr,Er,Wr,Ze,wn,uc,ut,ft,mn,jo;class wy{constructor(e){lr(this,wn),lr(this,ut),lr(this,mn),lr(this,hr,void 0),lr(this,Er,void 0),lr(this,Wr,void 0),lr(this,Ze,void 0),Di(this,hr,e),Di(this,Er,ct(this,wn,uc).call(this)),ct(this,ut,ft).call(this)}async connect(e){const{requiredNamespaces:r,optionalNamespaces:i}=e;return new Promise(async(n,o)=>{await ct(this,ut,ft).call(this);const u=Ce(this,Er).subscribeModal(y=>{y.open||(u(),o(new Error("Modal closed")))}),{uri:c,approval:l}=await Ce(this,Ze).connect(e);if(c){const y=new Set;r&&Object.values(r).forEach(({chains:d})=>{d&&d.forEach(I=>y.add(I))}),i&&Object.values(i).forEach(({chains:d})=>{d&&d.forEach(I=>y.add(I))}),await Ce(this,Er).openModal({uri:c,chains:Array.from(y)})}try{const y=await l();n(y)}catch(y){o(y)}finally{u(),Ce(this,Er).closeModal()}})}async disconnect(e){await ct(this,ut,ft).call(this),await Ce(this,Ze).disconnect(e)}async request(e){return await ct(this,ut,ft).call(this),await Ce(this,Ze).request(e)}async getSessions(){return await ct(this,ut,ft).call(this),Ce(this,Ze).session.getAll()}async getSession(){return await ct(this,ut,ft).call(this),Ce(this,Ze).session.getAll().at(-1)}async onSessionEvent(e){await ct(this,ut,ft).call(this),Ce(this,Ze).on("session_event",e)}async offSessionEvent(e){await ct(this,ut,ft).call(this),Ce(this,Ze).off("session_event",e)}async onSessionUpdate(e){await ct(this,ut,ft).call(this),Ce(this,Ze).on("session_update",e)}async offSessionUpdate(e){await ct(this,ut,ft).call(this),Ce(this,Ze).off("session_update",e)}async onSessionDelete(e){await ct(this,ut,ft).call(this),Ce(this,Ze).on("session_delete",e)}async offSessionDelete(e){await ct(this,ut,ft).call(this),Ce(this,Ze).off("session_delete",e)}async onSessionExpire(e){await ct(this,ut,ft).call(this),Ce(this,Ze).on("session_expire",e)}async offSessionExpire(e){await ct(this,ut,ft).call(this),Ce(this,Ze).off("session_expire",e)}}hr=new WeakMap,Er=new WeakMap,Wr=new WeakMap,Ze=new WeakMap,wn=new WeakSet,uc=function(){const{modalOptions:t,projectId:e}=Ce(this,hr);return new Eu(_y(by({},t),{projectId:e}))},ut=new WeakSet,ft=async function(){return Ce(this,Ze)?!0:(!Ce(this,Wr)&&typeof window<"u"&&Di(this,Wr,ct(this,mn,jo).call(this)),Ce(this,Wr))},mn=new WeakSet,jo=async function(){Di(this,Ze,await hy.init({metadata:Ce(this,hr).metadata,projectId:Ce(this,hr).projectId,relayUrl:Ce(this,hr).relayUrl}));const t=await Ce(this,Ze).core.crypto.getClientId();try{localStorage.setItem("WCM_WALLETCONNECT_CLIENT_ID",t)}catch{console.info("Unable to set client id")}};const vn=document.getElementById("connect-button"),lc="69e4593fefd274d4bbad0a7c0ef0995b";console.log(lc);const my=new wy({projectId:lc,metadata:{name:"My Dapp",description:"My Dapp description",url:"https://my-dapp.com",icons:["https://my-dapp.com/logo.png"]}});async function vy(){try{vn.disabled=!0;const t=await my.connect({requiredNamespaces:{eip155:{methods:["eth_sendTransaction","personal_sign"],chains:["eip155:1"],events:["chainChanged","accountsChanged"]}}});console.info(t)}catch(t){console.error(t)}finally{vn.disabled=!1}}vn.addEventListener("click",vy);export{cu as R,Bo as T,lt as a,fs as n,Dy as o,Nt as p,$i as s,Ey as t,Ir as y};
